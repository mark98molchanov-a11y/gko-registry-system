<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç–¥–µ–ª –ì–ö–û: –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π </title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- SheetJS (XLSX) -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        brand: { 
                            50: '#f0f9ff', 
                            100: '#e0f2fe', 
                            500: '#0ea5e9', 
                            600: '#0284c7', 
                            700: '#0369a1', 
                            800: '#075985', 
                            900: '#0c4a6e' 
                        },
                        superset: {
                            50: '#eef2ff',
                            500: '#4f46e5',
                            600: '#4338ca',
                            700: '#3730a3'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #f8fafc; }
        .custom-scroll::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        
        .tab-btn { 
            border-bottom: 2px solid transparent; 
            color: #64748b; 
            cursor: pointer; 
            transition: all 0.2s; 
            padding: 0.75rem 1.5rem;
            font-weight: 500;
        }
        .tab-btn:hover { color: #1e293b; }
        .tab-btn.active { 
            border-bottom: 2px solid #0ea5e9; 
            color: #0ea5e9; 
            font-weight: 600; 
        }
        
        .card-anim { transition: all 0.2s ease-out; }
        .card-anim:hover { transform: translateY(-2px); }

        .filter-chip {
            transition: all 0.2s;
            cursor: pointer;
            user-select: none;
            white-space: nowrap;
        }
        .filter-chip.active {
            background-color: #0ea5e9;
            color: white;
            border-color: #0ea5e9;
            box-shadow: 0 2px 4px rgba(14, 165, 233, 0.3);
        }
        .filter-chip:not(.active):hover {
            background-color: #e2e8f0;
            color: #334155;
        }

        .custom-checkbox {
            appearance: none;
            background-color: #fff;
            width: 1.25em; height: 1.25em;
            border: 2px solid #cbd5e1;
            border-radius: 0.35em;
            display: grid;
            place-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        #githubTokenModal {
    transition: opacity 0.2s;
}

#githubTokenModal {
    transition: opacity 0.2s;
}

#githubTokenModal:not(.hidden) {
    opacity: 1;
}

#githubTokenModal.hidden {
    opacity: 0;
    pointer-events: none;
}

#githubTokenInput {
    font-family: 'Consolas', 'Monaco', monospace;
    letter-spacing: 0.5px;
}
        .custom-checkbox::before {
            content: "";
            width: 0.75em; height: 0.75em;
            transform: scale(0);
            transition: 120ms transform ease-in-out;
            box-shadow: inset 1em 1em white;
            transform-origin: center;
            clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%);
        }
        .custom-checkbox:checked {
            background-color: #0ea5e9;
            border-color: #0ea5e9;
        }
        .custom-checkbox:checked::before { transform: scale(1); }
        
        .progress-bar-fill { transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
        
        .dashboard-card {
            border-left: 4px solid #4f46e5;
            position: relative;
            overflow: hidden;
        }
        .dashboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #4f46e510 0%, transparent 100%);
            border-radius: 0 0 0 60px;
        }
        
        .status-badge {
            font-size: 0.6rem;
            padding: 0.15rem 0.5rem;
            border-radius: 9999px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .status-active { background-color: #10b98120; color: #059669; }
        .status-draft { background-color: #f59e0b20; color: #d97706; }
        .status-archived { background-color: #6b728020; color: #4b5563; }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-out;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .chart-container { height: 260px; }
    </style>
</head>
<body class="text-slate-800 antialiased flex flex-col min-h-screen">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center gap-4">
                    <div class="bg-brand-900 text-white p-2 rounded-lg shadow-lg">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-slate-900 leading-none tracking-tight">–û—Ç–¥–µ–ª –ì–ö–û</h1>
                        <p class="text-xs text-slate-500 mt-1 font-medium">–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</p>
                    </div>
                </div>

                <div class="flex items-center gap-3">
                    <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏ -->
                    <div class="flex gap-2">
                        <!-- Combined JSON Import -->
<button onclick="importJson()" class="bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 px-4 py-2 rounded-lg text-sm font-medium transition shadow-sm flex items-center gap-2">
    <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10" />
    </svg>
    <span>–ò–º–ø–æ—Ä—Ç JSON</span>
</button>

<!-- Combined JSON Export -->
<button onclick="exportJson()" class="bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 px-4 py-2 rounded-lg text-sm font-medium transition shadow-sm flex items-center gap-2">
    <svg class="w-4 h-4 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
    </svg>
    <span>–≠–∫—Å–ø–æ—Ä—Ç JSON</span>
</button>

<!-- Save to GitHub -->
<button onclick="showGitHubTokenModal()" class="bg-emerald-500 hover:bg-emerald-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition shadow flex items-center gap-2">
    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
        <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"/>
    </svg>
    <span>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ GitHub</span>
</button>
                        
                        <!-- Reset Button -->
                        <button onclick="hardResetCurrent()" class="bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 px-4 py-2 rounded-lg text-sm font-medium transition shadow-sm flex items-center gap-2">
                            <svg class="w-4 h-4 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 011.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                            <span id="resetBtnText">–°–±—Ä–æ—Å</span>
                        </button>
                    </div>
                    
                    <!-- –ö–Ω–æ–ø–∫–∏ –∏–º–ø–æ—Ä—Ç–∞ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏ -->
                    <div id="npaImportButtons" class="flex gap-2">
                        <button onclick="document.getElementById('importInput').click()" class="bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 px-4 py-2 rounded-lg text-sm font-medium transition shadow-sm flex items-center gap-2">
                            <svg class="w-4 h-4 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                            <span>–ò–º–ø–æ—Ä—Ç Excel</span>
                        </button>
                        <input type="file" id="importInput" accept=".csv, .xlsx, .xls" class="hidden" onchange="handleFileImport(this)">
                    </div>
                    
                    <div id="dashboardsImportButtons" class="flex gap-2 hidden">
                        <button onclick="document.getElementById('importExcelInput').click()" class="bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 px-4 py-2 rounded-lg text-sm font-medium transition shadow-sm flex items-center gap-2">
                            <svg class="w-4 h-4 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                            <span>–ò–º–ø–æ—Ä—Ç Excel</span>
                        </button>
                        <input type="file" id="importExcelInput" accept=".csv, .xlsx, .xls" class="hidden" onchange="handleExcelImport(this)">
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏ -->
                    <button id="addButton" onclick="openModal()" class="bg-brand-600 hover:bg-brand-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition shadow flex items-center gap-2 active:scale-95">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                        <span id="addButtonText">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</span>
                    </button>
                </div>
            </div>
            
            <!-- Tabs Navigation -->
            <div class="flex border-b border-slate-200 -mb-px">
                <button onclick="switchTab('npas')" class="tab-btn active">üìö –†–µ–µ—Å—Ç—Ä –ù–ü–ê</button>
                <button onclick="switchTab('dashboards')" class="tab-btn">üìä –î–∞—à–±–æ—Ä–¥—ã Superset</button>
            </div>
        </div>
    </header>

    <!-- –í–∫–ª–∞–¥–∫–∞ 1: –†–µ–µ—Å—Ç—Ä –ù–ü–ê -->
    <main class="tab-content active" id="npasTab">
        <div class="flex-grow max-w-7xl w-full mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6 pb-24">
            <!-- DASHBOARD -->
            <section class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <!-- Total Card -->
                <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition cursor-pointer relative overflow-hidden group" onclick="resetAllFilters()">
                    <div class="absolute right-0 top-0 w-24 h-24 bg-brand-50 rounded-bl-full -mr-4 -mt-4 transition group-hover:bg-brand-100"></div>
                    <div class="relative z-10">
                        <h3 class="text-slate-400 text-xs font-bold uppercase tracking-wider mb-2">–ù–∞–π–¥–µ–Ω–æ –≤ –±–∞–∑–µ</h3>
                        <div class="text-4xl font-extrabold text-slate-900" id="statTotal">0</div>
                        <div class="mt-4 flex items-center text-xs text-brand-600 font-medium">
                            <span class="w-2 h-2 rounded-full bg-brand-500 mr-2"></span> –ó–∞–ø–∏—Å–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã
                        </div>
                    </div>
                </div>

                <!-- Docs Structure (Clickable) -->
                <div class="bg-white p-5 rounded-2xl border border-slate-200 shadow-sm md:col-span-3 flex flex-col justify-between">
                    <div class="flex justify-between items-center mb-4">
                         <h3 class="text-slate-400 text-xs font-bold uppercase tracking-wider">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ–∫—É—â–µ–π –≤—ã–±–æ—Ä–∫–∏</h3>
                         <span class="text-[10px] text-slate-400">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</span>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        
                        <!-- 237-–§–ó -->
                        <div onclick="setDocFilter('237-–§–ó')" class="p-3 rounded-xl bg-indigo-50 border border-indigo-100 cursor-pointer hover:bg-indigo-100 transition relative overflow-hidden group">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-bold text-indigo-900 text-xs">237-–§–ó</span>
                                <span class="bg-white/80 text-indigo-700 text-[10px] font-bold px-1.5 py-0.5 rounded" id="countFZ">0</span>
                            </div>
                            <div class="w-full bg-indigo-200 rounded-full h-1 overflow-hidden">
                                <div id="barFZ" class="bg-indigo-600 h-1 rounded-full progress-bar-fill" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <!-- –ü—Ä–∏–∫–∞–∑ -->
                        <div onclick="setDocFilter('–ü—Ä–∏–∫–∞–∑ ‚Ññ –ü/0336')" class="p-3 rounded-xl bg-sky-50 border border-sky-100 cursor-pointer hover:bg-sky-100 transition relative overflow-hidden group">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-bold text-sky-900 text-xs">–ü—Ä–∏–∫–∞–∑ –ü/0336</span>
                                <span class="bg-white/80 text-sky-700 text-[10px] font-bold px-1.5 py-0.5 rounded" id="countOrder">0</span>
                            </div>
                            <div class="w-full bg-sky-200 rounded-full h-1 overflow-hidden">
                                <div id="barOrder" class="bg-sky-600 h-1 rounded-full progress-bar-fill" style="width: 0%"></div>
                            </div>
                        </div>

                        <!-- 378.2 –ù–ö –†–§ -->
                        <div onclick="setDocFilter('378.2 –ù–ö –†–§')" class="p-3 rounded-xl bg-amber-50 border border-amber-100 cursor-pointer hover:bg-amber-100 transition relative overflow-hidden group">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-bold text-amber-900 text-xs">378.2 –ù–ö –†–§</span>
                                <span class="bg-white/80 text-amber-700 text-[10px] font-bold px-1.5 py-0.5 rounded" id="countNK">0</span>
                            </div>
                            <div class="w-full bg-amber-200 rounded-full h-1 overflow-hidden">
                                <div id="barNK" class="bg-amber-600 h-1 rounded-full progress-bar-fill" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Main Controls & Chart -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Left: Controls -->
                <div class="lg:col-span-2 space-y-4">
                     <!-- Search & Sort -->
                    <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex flex-col sm:flex-row gap-4">
                        <div class="relative flex-grow">
                            <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-slate-400">
                                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                            </span>
                            <input type="text" id="searchInput" oninput="renderGrid()" placeholder="–ü–æ–∏—Å–∫..." class="pl-10 pr-4 py-2.5 w-full border border-slate-200 bg-slate-50 rounded-lg text-sm focus:bg-white focus:ring-2 focus:ring-brand-500 outline-none">
                        </div>
                        <select id="sortSelect" onchange="renderGrid()" class="py-2.5 px-3 bg-slate-50 border border-slate-200 rounded-lg text-sm outline-none cursor-pointer">
                            <option value="lastUpdated">üïí –ü–æ –≤—Ä–µ–º–µ–Ω–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è</option>
                            <option value="dateDesc">üìÖ –ü–æ –¥–∞—Ç–µ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è (–Ω–æ–≤—ã–µ)</option>
                            <option value="dateAsc">üìÖ –ü–æ –¥–∞—Ç–µ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è (—Å—Ç–∞—Ä—ã–µ)</option>
                        </select>
                    </div>

                    <!-- Filters -->
                    <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm space-y-4">
                         <div>
                            <div class="text-[10px] font-bold text-slate-400 uppercase mb-2">–§–∏–ª—å—Ç—Ä –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç—É</div>
                            <div class="flex gap-2 overflow-x-auto custom-scroll pb-1" id="docFilterContainer"></div>
                         </div>
                         <div>
                            <div class="text-[10px] font-bold text-slate-400 uppercase mb-2">–§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É</div>
                            <div class="flex gap-2 flex-wrap" id="typeFilterContainer"></div>
                         </div>
                         <div>
                            <div class="text-[10px] font-bold text-slate-400 uppercase mb-2">–¢–µ–≥–∏</div>
                            <div class="flex gap-2 flex-wrap" id="targetContainer"></div>
                         </div>
                    </div>
                    
                    <!-- Active Filters Bar -->
                    <div id="activeFiltersBar" class="hidden flex items-center justify-between bg-brand-50 border border-brand-100 text-brand-700 px-4 py-2 rounded-lg text-sm">
                        <span class="font-medium">–§–∏–ª—å—Ç—Ä—ã –∞–∫—Ç–∏–≤–Ω—ã</span>
                        <button onclick="resetAllFilters()" class="text-xs font-bold uppercase hover:text-brand-900 underline">–°–±—Ä–æ—Å–∏—Ç—å</button>
                    </div>
                </div>

                <!-- Right: Bar Chart -->
                <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex flex-col">
                    <h4 class="text-xs font-bold text-slate-400 uppercase mb-2 text-center">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (–≤ —Ç–µ–∫—É—â–µ–π –≤—ã–±–æ—Ä–∫–µ)</h4>
                    <div class="flex-grow relative" style="min-height: 300px;">
                        <canvas id="typeChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- LIST HEADER -->
            <div class="flex items-center justify-between mt-2 mb-1">
                <div class="text-sm text-slate-500 font-medium">–°–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π (<span id="filteredCount">0</span>)</div>
                <button onclick="toggleSelectAll()" class="text-xs text-brand-600 font-bold hover:underline">–í—ã–±—Ä–∞—Ç—å –ø–æ–∫–∞–∑–∞–Ω–Ω—ã–µ</button>
            </div>
            
            <!-- GRID -->
            <div id="cardsGrid" class="grid grid-cols-1 gap-4"></div>
        </div>
    </main>

    <!-- –í–∫–ª–∞–¥–∫–∞ 2: –î–∞—à–±–æ—Ä–¥—ã Superset -->
    <main class="tab-content" id="dashboardsTab">
        <div class="flex-grow max-w-7xl w-full mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6 pb-24">
            <!-- Dashboard Summary Cards -->
            <section class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <!-- Total Dashboards -->
                <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition cursor-pointer relative overflow-hidden group" onclick="resetAllDashboardsFilters()">
                    <div class="absolute right-0 top-0 w-24 h-24 bg-superset-50 rounded-bl-full -mr-4 -mt-4 transition group-hover:bg-superset-100"></div>
                    <div class="relative z-10">
                        <h3 class="text-slate-400 text-xs font-bold uppercase tracking-wider mb-2">–í—Å–µ–≥–æ –¥–∞—à–±–æ—Ä–¥–æ–≤</h3>
                        <div class="text-4xl font-extrabold text-slate-900" id="statTotalDashboards">0</div>
                        <div class="mt-4 flex items-center text-xs text-superset-600 font-medium">
                            <span class="w-2 h-2 rounded-full bg-superset-500 mr-2"></span> –í —Å–∏—Å—Ç–µ–º–µ Apache Superset
                        </div>
                    </div>
                </div>

                <!-- Active Dashboards -->
                <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition cursor-pointer relative overflow-hidden group" onclick="setStatusFilterDashboards('active')">
                    <div class="absolute right-0 top-0 w-24 h-24 bg-emerald-50 rounded-bl-full -mr-4 -mt-4 transition group-hover:bg-emerald-100"></div>
                    <div class="relative z-10">
                        <h3 class="text-slate-400 text-xs font-bold uppercase tracking-wider mb-2">–ê–∫—Ç–∏–≤–Ω—ã–µ</h3>
                        <div class="text-4xl font-extrabold text-emerald-600" id="statActiveDashboards">0</div>
                        <div class="mt-4 flex items-center text-xs text-emerald-600 font-medium">
                            <span class="w-2 h-2 rounded-full bg-emerald-500 mr-2"></span> –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ä–∞–±–æ—Ç–µ
                        </div>
                    </div>
                </div>

                <!-- By Type Card -->
                <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition cursor-pointer relative overflow-hidden group md:col-span-2">
                    <div class="absolute right-0 top-0 w-24 h-24 bg-amber-50 rounded-bl-full -mr-4 -mt-4 transition group-hover:bg-amber-100"></div>
                    <div class="relative z-10">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-slate-400 text-xs font-bold uppercase tracking-wider">–ü–æ —Ç–∏–ø–∞–º –∞–Ω–∞–ª–∏–∑–∞</h3>
                            <span class="text-[10px] text-slate-400">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</span>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div onclick="setTypeFilterDashboards('analytical')" class="p-2.5 rounded-xl bg-slate-50 border border-slate-100 cursor-pointer hover:bg-slate-100 transition">
                                <div class="flex justify-between items-center">
                                    <span class="font-bold text-slate-700 text-xs">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</span>
                                    <span class="bg-white text-slate-700 text-[10px] font-bold px-1.5 py-0.5 rounded" id="countAnalytical">0</span>
                                </div>
                            </div>
                            <div onclick="setTypeFilterDashboards('monitoring')" class="p-2.5 rounded-xl bg-blue-50 border border-blue-100 cursor-pointer hover:bg-blue-100 transition">
                                <div class="flex justify-between items-center">
                                    <span class="font-bold text-blue-700 text-xs">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</span>
                                    <span class="bg-white text-blue-700 text-[10px] font-bold px-1.5 py-0.5 rounded" id="countMonitoring">0</span>
                                </div>
                            </div>
                            <div onclick="setTypeFilterDashboards('operational')" class="p-2.5 rounded-xl bg-purple-50 border border-purple-100 cursor-pointer hover:bg-purple-100 transition">
                                <div class="flex justify-between items-center">
                                    <span class="font-bold text-purple-700 text-xs">–û–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ</span>
                                    <span class="bg-white text-purple-700 text-[10px] font-bold px-1.5 py-0.5 rounded" id="countOperational">0</span>
                                </div>
                            </div>
                            <div onclick="setTypeFilterDashboards('reporting')" class="p-2.5 rounded-xl bg-rose-50 border border-rose-100 cursor-pointer hover:bg-rose-100 transition">
                                <div class="flex justify-between items-center">
                                    <span class="font-bold text-rose-700 text-xs">–û—Ç—á–µ—Ç–Ω–æ—Å—Ç—å</span>
                                    <span class="bg-white text-rose-700 text-[10px] font-bold px-1.5 py-0.5 rounded" id="countReporting">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Controls & Stats -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Left: Controls -->
                <div class="lg:col-span-2 space-y-4">
                    <!-- Search & Sort -->
                    <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex flex-col sm:flex-row gap-4">
                        <div class="relative flex-grow">
                            <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-slate-400">
                                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                </svg>
                            </span>
                            <input type="text" id="searchInputDashboards" oninput="renderDashboardsGrid()" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –æ–ø–∏—Å–∞–Ω–∏—é..." class="pl-10 pr-4 py-2.5 w-full border border-slate-200 bg-slate-50 rounded-lg text-sm focus:bg-white focus:ring-2 focus:ring-brand-500 outline-none">
                        </div>
                        <select id="sortSelectDashboards" onchange="renderDashboardsGrid()" class="py-2.5 px-3 bg-slate-50 border border-slate-200 rounded-lg text-sm outline-none cursor-pointer">
                            <option value="createdDesc">üìÖ –ü–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è (–Ω–æ–≤—ã–µ)</option>
                            <option value="createdAsc">üìÖ –ü–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è (—Å—Ç–∞—Ä—ã–µ)</option>
                            <option value="nameAsc">üî§ –ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é (–ê-–Ø)</option>
                            <option value="nameDesc">üî§ –ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é (–Ø-–ê)</option>
                        </select>
                    </div>

                    <!-- Filters -->
                    <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm space-y-4">
                        <div>
                            <div class="text-[10px] font-bold text-slate-400 uppercase mb-2">–°—Ç–∞—Ç—É—Å</div>
                            <div class="flex gap-2 overflow-x-auto custom-scroll pb-1" id="statusFilterContainerDashboards"></div>
                        </div>
                        <div>
                            <div class="text-[10px] font-bold text-slate-400 uppercase mb-2">–¢–∏–ø –∞–Ω–∞–ª–∏–∑–∞</div>
                            <div class="flex gap-2 flex-wrap" id="typeFilterContainerDashboards"></div>
                        </div>
                        <div>
                            <div class="text-[10px] font-bold text-slate-400 uppercase mb-2">–¢–µ–≥–∏</div>
                            <div class="flex gap-2 flex-wrap" id="tagsContainerDashboards"></div>
                        </div>
                    </div>
                    
                    <!-- Active Filters Bar -->
                    <div id="activeFiltersBarDashboards" class="hidden flex items-center justify-between bg-brand-50 border border-brand-100 text-brand-700 px-4 py-2 rounded-lg text-sm">
                        <span class="font-medium">–§–∏–ª—å—Ç—Ä—ã –∞–∫—Ç–∏–≤–Ω—ã</span>
                        <button onclick="resetAllDashboardsFilters()" class="text-xs font-bold uppercase hover:text-brand-900 underline">–°–±—Ä–æ—Å–∏—Ç—å</button>
                    </div>
                </div>

                <!-- Right: Chart -->
                <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex flex-col">
                    <h4 class="text-xs font-bold text-slate-400 uppercase mb-2 text-center">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–∏–ø—É –∞–Ω–∞–ª–∏–∑–∞</h4>
                    <div class="chart-container">
                        <canvas id="typeChartDashboards"></canvas>
                    </div>
                </div>
            </div>

            <!-- List Header -->
            <div class="flex items-center justify-between mt-2 mb-1">
                <div class="text-sm text-slate-500 font-medium">–î–∞—à–±–æ—Ä–¥—ã (<span id="filteredCountDashboards">0</span>)</div>
                <div class="flex gap-2">
                    <button onclick="exportToExcelDashboards()" class="text-xs text-emerald-600 font-bold hover:underline flex items-center gap-1">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        –≠–∫—Å–ø–æ—Ä—Ç Excel
                    </button>
                    <button onclick="toggleSelectAllDashboards()" class="text-xs text-brand-600 font-bold hover:underline ml-4">–í—ã–±—Ä–∞—Ç—å –ø–æ–∫–∞–∑–∞–Ω–Ω—ã–µ</button>
                </div>
            </div>
            
            <!-- DASHBOARDS GRID -->
            <div id="cardsGridDashboards" class="grid grid-cols-1 lg:grid-cols-2 gap-6"></div>
        </div>
    </main>

    <!-- Footer - –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π -->
    <footer class="bg-white border-t border-slate-200 mt-auto py-4">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-sm text-slate-400">&copy; 2026 –û—Ç–¥–µ–ª –ì–ö–û</p>
        </div>
    </footer>

    <!-- Bulk Toolbar for NPA -->
    <div id="bulkToolbar" class="fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-slate-900 text-white px-6 py-3 rounded-full shadow-2xl z-40 hidden flex items-center gap-6 animate-bounce-in transition-all">
        <div class="text-sm font-medium"><span id="bulkCount">0</span> –≤—ã–±—Ä–∞–Ω–æ</div>
        <div class="h-4 w-px bg-slate-700"></div>
        <div class="flex gap-2">
            <button onclick="openBulkEditModal()" class="hover:text-brand-400 transition text-sm font-bold flex items-center gap-1">‚úèÔ∏è –ü—Ä–∞–≤–∫–∞</button>
            <button onclick="bulkDelete()" class="hover:text-red-400 transition text-sm font-bold flex items-center gap-1 ml-2">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
        </div>
        <button onclick="clearSelection()" class="ml-4 text-slate-500 hover:text-white text-xs">&times;</button>
    </div>

    <!-- Bulk Toolbar for Dashboards -->
    <div id="bulkToolbarDashboards" class="fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-slate-900 text-white px-6 py-3 rounded-full shadow-2xl z-40 hidden flex items-center gap-6 animate-bounce-in transition-all">
        <div class="text-sm font-medium"><span id="bulkCountDashboards">0</span> –≤—ã–±—Ä–∞–Ω–æ</div>
        <div class="h-4 w-px bg-slate-700"></div>
        <div class="flex gap-2">
            <button onclick="openBulkEditModalDashboards()" class="hover:text-brand-400 transition text-sm font-bold flex items-center gap-1">‚úèÔ∏è –ü—Ä–∞–≤–∫–∞</button>
            <button onclick="bulkDeleteDashboards()" class="hover:text-red-400 transition text-sm font-bold flex items-center gap-1 ml-2">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
            <button onclick="bulkOpenDashboards()" class="hover:text-emerald-400 transition text-sm font-bold flex items-center gap-1 ml-2">üîó –û—Ç–∫—Ä—ã—Ç—å</button>
        </div>
        <button onclick="clearSelectionDashboards()" class="ml-4 text-slate-500 hover:text-white text-xs">&times;</button>
    </div>

    <!-- Edit Modal for NPA -->
    <div id="modal" class="fixed inset-0 z-50 hidden opacity-0 transition-opacity duration-300">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeModal()"></div>
        <div class="relative bg-white w-full max-w-3xl mx-auto mt-10 rounded-2xl shadow-2xl flex flex-col max-h-[90vh] overflow-hidden transform transition-all scale-95" id="modalContent">
            <div class="px-8 py-5 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                <h3 class="text-xl font-bold text-slate-800" id="modalTitle">–ó–∞–ø–∏—Å—å</h3>
                <button onclick="closeModal()" class="text-slate-400 hover:text-slate-700 text-2xl leading-none">&times;</button>
            </div>
            <div class="p-8 overflow-y-auto custom-scroll space-y-5">
                <input type="hidden" id="editId">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞</label>
                        <input type="text" id="editDoc" list="docSuggestions" class="w-full border border-slate-300 rounded-lg px-4 py-2.5 text-sm font-medium focus:ring-2 focus:ring-brand-500 outline-none">
                        <datalist id="docSuggestions"></datalist>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">–ù–æ—Ä–º–∞ / –°—Ç–∞—Ç—å—è</label>
                        <input type="text" id="editNorm" class="w-full border border-slate-300 rounded-lg px-4 py-2.5 text-sm outline-none">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div><label class="block text-xs font-bold text-slate-500 uppercase mb-2">–¢–∏–ø</label><select id="editType" class="w-full border border-slate-300 rounded-lg px-4 py-2.5 text-sm bg-white outline-none"><option value="–î–∞–Ω–Ω—ã–µ">–î–∞–Ω–Ω—ã–µ</option><option value="–ê–Ω–∞–ª–∏—Ç–∏–∫–∞">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</option><option value="–ü—Ä–∞–∫—Ç–∏–∫–∞">–ü—Ä–∞–∫—Ç–∏–∫–∞</option><option value="–¶–∏—Ñ—Ä–∞">–¶–∏—Ñ—Ä–∞ / –ì–ò–°</option><option value="–§–∏–Ω–∞–Ω—Å—ã">–§–∏–Ω–∞–Ω—Å—ã</option><option value="–ü—Ä–æ—Ü–µ–¥—É—Ä–∞">–ü—Ä–æ—Ü–µ–¥—É—Ä–∞</option><option value="–ö–æ–Ω—Ç—Ä–æ–ª—å">–ö–æ–Ω—Ç—Ä–æ–ª—å</option><option value="–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è</option><option value="–ú–µ—Ç–æ–¥">–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è</option><option value="–°—Ä–æ–∫">–°—Ä–æ–∫–∏</option><option value="–°—É—Ç—å">–°—É—Ç—å/–ü–æ–Ω—è—Ç–∏—è</option><option value="–†–µ–≥–ª–∞–º–µ–Ω—Ç">–†–µ–≥–ª–∞–º–µ–Ω—Ç</option><option value="–§—É–Ω–∫—Ü–∏—è">–§—É–Ω–∫—Ü–∏—è</option><option value="–û—Å–æ–±.">–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</option><option value="–ö–∞—á–µ—Å—Ç–≤–æ">–ö–∞—á–µ—Å—Ç–≤–æ</option><option value="–¢–æ—á–Ω–æ—Å—Ç—å">–¢–æ—á–Ω–æ—Å—Ç—å</option><option value="–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞">–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</option><option value="–°–µ–≥–º–µ–Ω—Ç—ã">–°–µ–≥–º–µ–Ω—Ç—ã</option><option value="–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å">–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å</option></select></div>
                    <div><label class="block text-xs font-bold text-slate-500 uppercase mb-2">–¢–µ–≥–∏</label><input type="text" id="editTarget" class="w-full border border-slate-300 rounded-lg px-4 py-2.5 text-sm outline-none"></div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-slate-50 p-4 rounded-xl border border-slate-200">
                    <div><label class="block text-xs font-bold text-red-500 uppercase mb-2">–ë—ã–ª–æ</label><textarea id="editBefore" rows="3" class="w-full border border-red-200 bg-white rounded-lg px-3 py-2 text-sm resize-none outline-none"></textarea></div>
                    <div><label class="block text-xs font-bold text-emerald-600 uppercase mb-2">–°—Ç–∞–ª–æ</label><textarea id="editAfter" rows="3" class="w-full border border-emerald-200 bg-white rounded-lg px-3 py-2 text-sm resize-none outline-none"></textarea></div>
                </div>
                <div><label class="block text-xs font-bold text-slate-500 uppercase mb-2">–ü–æ—è—Å–Ω–µ–Ω–∏–µ</label><textarea id="editHuman" rows="2" class="w-full border border-slate-300 rounded-lg px-4 py-2.5 text-sm outline-none"></textarea></div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-slate-100 p-4 rounded-xl">
                     <div><label class="block text-xs font-bold text-slate-600 uppercase mb-2">–û—Å–Ω–æ–≤–∞–Ω–∏–µ</label><input type="text" id="editChangeDoc" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm outline-none"></div>
                     <div><label class="block text-xs font-bold text-slate-600 uppercase mb-2">–î–∞—Ç–∞</label><input type="text" id="editDate" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm outline-none"></div>
                </div>
                <div class="border-t border-slate-200 pt-4">
                    <button type="button" onclick="document.getElementById('fullTextGroup').classList.toggle('hidden')" class="text-xs text-brand-600 font-bold hover:underline flex items-center gap-1">–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç ‚ñº</button>
                    <div id="fullTextGroup" class="hidden mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label class="block text-[10px] uppercase font-bold text-slate-400">–°—Ç–∞—Ä–∞—è —Ä–µ–¥.</label><textarea id="editFullOld" rows="4" class="w-full bg-slate-50 border border-slate-200 text-xs font-mono p-2 rounded"></textarea></div>
                        <div><label class="block text-[10px] uppercase font-bold text-brand-600">–ù–æ–≤–∞—è —Ä–µ–¥.</label><textarea id="editFullNew" rows="4" class="w-full bg-slate-50 border border-slate-200 text-xs font-mono p-2 rounded"></textarea></div>
                    </div>
                </div>
                <div><label class="block text-xs font-bold text-amber-600 uppercase mb-2">–ü—Ä–∏–º–µ—Ä</label><input type="text" id="editExample" class="w-full border border-amber-200 rounded-lg px-3 py-2 text-sm bg-amber-50 outline-none"></div>
            </div>
            <div class="p-6 border-t border-slate-100 bg-slate-50 flex justify-end gap-3">
                <button type="button" onclick="closeModal()" class="px-5 py-2.5 text-slate-500 hover:text-slate-800 font-medium">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" onclick="saveItem()" class="px-6 py-2.5 bg-brand-600 text-white rounded-lg hover:bg-brand-700 font-medium shadow-md">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>
    
    <!-- Bulk Modal for NPA -->
    <div id="bulkModal" class="fixed inset-0 z-50 hidden opacity-0 transition-opacity duration-300">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeBulkModal()"></div>
        <div class="relative bg-white w-full max-w-md mx-auto mt-32 rounded-2xl shadow-2xl overflow-hidden transform transition-all scale-95" id="bulkModalContent">
            <div class="px-6 py-4 border-b border-slate-100 bg-slate-50"><h3 class="text-lg font-bold text-slate-800">–ú–∞—Å—Å–æ–≤–∞—è –ø—Ä–∞–≤–∫–∞</h3></div>
            <div class="p-6 space-y-4">
                <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">–¢–∏–ø</label><select id="bulkType" class="w-full border p-2 rounded text-sm"><option value="">(–ù–µ –º–µ–Ω—è—Ç—å)</option><option value="–î–∞–Ω–Ω—ã–µ">–î–∞–Ω–Ω—ã–µ</option><option value="–ê–Ω–∞–ª–∏—Ç–∏–∫–∞">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</option><option value="–¶–∏—Ñ—Ä–∞">–¶–∏—Ñ—Ä–∞</option><option value="–§–∏–Ω–∞–Ω—Å—ã">–§–∏–Ω–∞–Ω—Å—ã</option></select></div>
                <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">–û—Å–Ω–æ–≤–∞–Ω–∏–µ</label><input type="text" id="bulkChangeDoc" placeholder="(–ù–µ –º–µ–Ω—è—Ç—å)" class="w-full border p-2 rounded text-sm"></div>
            </div>
            <div class="p-4 border-t flex justify-end gap-3">
                <button onclick="closeBulkModal()" class="text-slate-500">–û—Ç–º–µ–Ω–∞</button>
                <button onclick="applyBulkEdit()" class="bg-brand-600 text-white px-4 py-2 rounded-lg">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Edit Modal for Dashboards -->
    <div id="modalDashboards" class="fixed inset-0 z-50 hidden opacity-0 transition-opacity duration-300">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeModalDashboards()"></div>
        <div class="relative bg-white w-full max-w-3xl mx-auto mt-10 rounded-2xl shadow-2xl flex flex-col max-h-[90vh] overflow-hidden transform transition-all scale-95" id="modalContentDashboards">
            <div class="px-8 py-5 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                <h3 class="text-xl font-bold text-slate-800" id="modalTitleDashboards">–î–∞—à–±–æ—Ä–¥</h3>
                <button onclick="closeModalDashboards()" class="text-slate-400 hover:text-slate-700 text-2xl leading-none">&times;</button>
            </div>
            <div class="p-8 overflow-y-auto custom-scroll space-y-5">
                <input type="hidden" id="editIdDashboards">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">–ù–∞–∑–≤–∞–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–∞ *</label>
                        <input type="text" id="editTitleDashboards" class="w-full border border-slate-300 rounded-lg px-4 py-2.5 text-sm font-medium focus:ring-2 focus:ring-brand-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">–°—Å—ã–ª–∫–∞ –Ω–∞ Superset *</label>
                        <input type="text" id="editUrlDashboards" placeholder="https://superset.example.com/dashboard/123/" class="w-full border border-slate-300 rounded-lg px-4 py-2.5 text-sm font-medium focus:ring-2 focus:ring-brand-500 outline-none">
                    </div>
                </div>
                
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-2">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea id="editDescriptionDashboards" rows="2" class="w-full border border-slate-300 rounded-lg px-4 py-2.5 text-sm outline-none" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è –¥–∞—à–±–æ—Ä–¥–∞"></textarea>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">–¢–∏–ø –∞–Ω–∞–ª–∏–∑–∞</label>
                        <select id="editAnalysisTypeDashboards" class="w-full border border-slate-300 rounded-lg px-4 py-2.5 text-sm bg-white outline-none">
                            <option value="analytical">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</option>
                            <option value="monitoring">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</option>
                            <option value="operational">–û–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</option>
                            <option value="reporting">–û—Ç—á–µ—Ç–Ω–æ—Å—Ç—å</option>
                            <option value="forecast">–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ</option>
                            <option value="audit">–î–µ—è–µ—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ì–ë–£</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">–°—Ç–∞—Ç—É—Å</label>
                        <select id="editStatusDashboards" class="w-full border border-slate-300 rounded-lg px-4 py-2.5 text-sm bg-white outline-none">
                            <option value="active">–ê–∫—Ç–∏–≤–Ω—ã–π</option>
                            <option value="draft">–ß–µ—Ä–Ω–æ–≤–∏–∫</option>
                            <option value="archived">–ê—Ä—Ö–∏–≤–Ω—ã–π</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">–í–ª–∞–¥–µ–ª–µ—Ü</label>
                        <input type="text" id="editOwnerDashboards" class="w-full border border-slate-300 rounded-lg px-4 py-2.5 text-sm outline-none" placeholder="–§–ò–û –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ">
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
                        <input type="text" id="editTagsDashboards" class="w-full border border-slate-300 rounded-lg px-4 py-2.5 text-sm outline-none" placeholder="–ì–ö–û, –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å, –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</label>
                        <input type="date" id="editCreatedDateDashboards" class="w-full border border-slate-300 rounded-lg px-4 py-2.5 text-sm outline-none">
                    </div>
                </div>
                
                <div class="bg-slate-50 p-4 rounded-xl border border-slate-200">
                    <div class="text-xs font-bold text-slate-500 uppercase mb-2">–î–∞–Ω–Ω—ã–µ –∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∏</div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-[10px] uppercase font-bold text-slate-400 mb-1">–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö</label>
                            <input type="text" id="editDataSourceDashboards" class="w-full border border-slate-200 text-sm p-2 rounded" placeholder="–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, API, —Ñ–∞–π–ª">
                        </div>
                        <div>
                            <label class="block text-[10px] uppercase font-bold text-slate-400 mb-1">–ß–∞—Å—Ç–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</label>
                            <select id="editUpdateFrequencyDashboards" class="w-full border border-slate-200 text-sm p-2 rounded">
                                <option value="realtime">–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è</option>
                                <option value="daily">–ï–∂–µ–¥–Ω–µ–≤–Ω–æ</option>
                                <option value="weekly">–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ</option>
                                <option value="monthly">–ï–∂–µ–º–µ—Å—è—á–Ω–æ</option>
                                <option value="quarterly">–ö–≤–∞—Ä—Ç–∞–ª—å–Ω–æ</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-2">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ / –ü—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
                    <textarea id="editNotesDashboards" rows="3" class="w-full border border-slate-300 rounded-lg px-4 py-2.5 text-sm outline-none" placeholder="–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –≤–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è"></textarea>
                </div>
            </div>
            <div class="p-6 border-t border-slate-100 bg-slate-50 flex justify-end gap-3">
                <button type="button" onclick="closeModalDashboards()" class="px-5 py-2.5 text-slate-500 hover:text-slate-800 font-medium">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" onclick="testUrlDashboards()" class="px-5 py-2.5 bg-slate-200 text-slate-700 rounded-lg hover:bg-slate-300 font-medium">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Å—ã–ª–∫—É</button>
                <button type="button" onclick="saveDashboard()" class="px-6 py-2.5 bg-brand-600 text-white rounded-lg hover:bg-brand-700 font-medium shadow-md">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>
    
    <!-- Bulk Modal for Dashboards -->
    <div id="bulkModalDashboards" class="fixed inset-0 z-50 hidden opacity-0 transition-opacity duration-300">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeBulkModalDashboards()"></div>
        <div class="relative bg-white w-full max-w-md mx-auto mt-32 rounded-2xl shadow-2xl overflow-hidden transform transition-all scale-95" id="bulkModalContentDashboards">
            <div class="px-6 py-4 border-b border-slate-100 bg-slate-50">
                <h3 class="text-lg font-bold text-slate-800">–ú–∞—Å—Å–æ–≤–∞—è –ø—Ä–∞–≤–∫–∞ –¥–∞—à–±–æ—Ä–¥–æ–≤</h3>
            </div>
            <div class="p-6 space-y-4">
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">–°—Ç–∞—Ç—É—Å</label>
                    <select id="bulkStatusDashboards" class="w-full border p-2 rounded text-sm">
                        <option value="">(–ù–µ –º–µ–Ω—è—Ç—å)</option>
                        <option value="active">–ê–∫—Ç–∏–≤–Ω—ã–π</option>
                        <option value="draft">–ß–µ—Ä–Ω–æ–≤–∏–∫</option>
                        <option value="archived">–ê—Ä—Ö–∏–≤–Ω—ã–π</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">–í–ª–∞–¥–µ–ª–µ—Ü</label>
                    <input type="text" id="bulkOwnerDashboards" placeholder="(–ù–µ –º–µ–Ω—è—Ç—å)" class="w-full border p-2 rounded text-sm">
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">–¢–µ–≥–∏ (–¥–æ–±–∞–≤–∏—Ç—å)</label>
                    <input type="text" id="bulkTagsDashboards" placeholder="–ß–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é" class="w-full border p-2 rounded text-sm">
                </div>
            </div>
            <div class="p-4 border-t flex justify-end gap-3">
                <button onclick="closeBulkModalDashboards()" class="text-slate-500">–û—Ç–º–µ–Ω–∞</button>
                <button onclick="applyBulkEditDashboards()" class="bg-brand-600 text-white px-4 py-2 rounded-lg">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>
    <div id="githubTokenModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/50" onclick="closeGitHubModal()"></div>
        <div class="relative bg-white w-96 mx-auto mt-32 rounded-xl shadow-xl p-6">
            <h3 class="text-lg font-bold mb-4">üîë GitHub Token</h3>
            
            <input 
                type="password" 
                id="githubTokenInput" 
                placeholder="github_pat_..." 
                class="w-full border p-3 rounded-lg mb-3 text-sm font-mono"
                autocomplete="off"
            >
            
            <p class="text-xs text-gray-500 mb-4">
                –í–≤–µ–¥–∏—Ç–µ Personal Access Token —Å –ø—Ä–∞–≤–∞–º–∏ <code>repo</code>
            </p>
            
            <div class="flex gap-2">
                <button onclick="closeGitHubModal()" class="flex-1 py-2 border rounded-lg">–û—Ç–º–µ–Ω–∞</button>
                <button onclick="saveToGitHub()" class="flex-1 py-2 bg-emerald-500 text-white rounded-lg">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>
    <!-- ========== –ö–û–ù–ï–¶ –ú–û–î–ê–õ–¨–ù–û–ì–û –û–ö–ù–ê GITHUB TOKEN ========== -->

</body>
</html>
<script>
    // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –î–õ–Ø –í–°–ï–ì–û –°–ö–†–ò–ü–¢–ê
    window.GITHUB_RAW_URL = 'https://raw.githubusercontent.com/mark98molchanov-a11y/mark98molchanov-a12y.gko-registry-system/main/';
    
    const STORAGE_KEY_NPA = 'rosreestr_npa_viz_v5';
    const STORAGE_KEY_DASHBOARDS = 'gko_dashboards_v2';
    const STORAGE_KEY_ALL = 'gko_all_data.json';
    const now = Date.now();
    const GITHUB_SYNC_ENABLED = true;
    
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
    const GITHUB_SYNC_API = window.GITHUB_RAW_URL;

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ GitHub –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ GitHub –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
async function loadFromGitHub() {
    if (!GITHUB_SYNC_ENABLED) {
        loadData();
        loadDashboardsData();
        return;
    }
    
    try {
        console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ GitHub...');
        
        // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–∞–π–ª
        const response = await fetch(`${GITHUB_SYNC_API}gko_all_data.json`);
        
        if (!response.ok) {
            throw new Error(`–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω (${response.status})`);
        }
        
        const json = await response.json();
        
        // –ü–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Ç–µ, —á—Ç–æ –∏–∑ GitHub
        if (json.npas && Array.isArray(json.npas)) {
            appData = [...json.npas];
            localStorage.setItem(STORAGE_KEY_NPA, JSON.stringify(appData));
            console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${json.npas.length} –∑–∞–ø–∏—Å–µ–π –ù–ü–ê`);
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–µ—Ä–≤—É—é –≤–∫–ª–∞–¥–∫—É
            renderGrid();
        }
        
        if (json.dashboards && Array.isArray(json.dashboards)) {
            dashboardsData = [...json.dashboards];
            localStorage.setItem(STORAGE_KEY_DASHBOARDS, JSON.stringify(dashboardsData));
            console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${json.dashboards.length} –¥–∞—à–±–æ—Ä–¥–æ–≤`);
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ç–æ—Ä—É—é –≤–∫–ª–∞–¥–∫—É, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞
            if (currentTab === 'dashboards') {
                renderDashboardsGrid();
            } else {
                // –í—Å–µ —Ä–∞–≤–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ, –Ω–æ –Ω–µ —Ä–µ–Ω–¥–µ—Ä–∏–º
                // –§—É–Ω–∫—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
                updateDashboardStatsDashboards();
                renderStatusFiltersDashboards();
                renderTypeFiltersDashboards();
                renderTagsDashboards();
            }
        }
        
        showNotification('‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ GitHub', 'success');
        
catch (error) {
    console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ GitHub:', error.message);
    // –ü—Ä–æ—Å—Ç–æ –∑–∞–≥—Ä—É–∂–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ–ø–µ—Ä—å –ø—É—Å—Ç—ã–µ –∏–ª–∏ –∏–∑ localStorage)
    loadData();
    loadDashboardsData();
}
}
// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ GitHub
let currentGitHubToken = null;

// –ü–æ–∫–∞–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
function showGitHubTokenModal() {
    document.getElementById('githubTokenInput').value = '';
    document.getElementById('githubTokenModal').classList.remove('hidden');
    document.getElementById('githubTokenInput').focus();
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
function closeGitHubModal() {
    document.getElementById('githubTokenModal').classList.add('hidden');
    document.getElementById('githubTokenInput').value = '';
    currentGitHubToken = null;
}
async function saveToGitHub() {
    const token = document.getElementById('githubTokenInput').value.trim();
    
    if (!token) {
        alert('–í–≤–µ–¥–∏—Ç–µ GitHub Token');
        return;
    }
    
    currentGitHubToken = token;
    
    // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ
    const allData = {
        version: "1.0",
        exportDate: new Date().toISOString(),
        npas: appData,
        dashboards: dashboardsData
    };
    
    const content = JSON.stringify(allData, null, 2);
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
    const owner = 'mark98molchanov-a11y';
    const repo = 'mark98molchanov-a12y.gko-registry-system';
    const path = 'gko_all_data.json';
    const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
    
    try {
        // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π —Ñ–∞–π–ª (–µ—Å–ª–∏ –µ—Å—Ç—å)
        let sha = null;
        try {
            const res = await fetch(apiUrl, {
                headers: {
                    'Authorization': `token ${token}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            });
            if (res.ok) {
                const data = await res.json();
                sha = data.sha;
            }
        } catch (e) { /* –§–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç */ }
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª
        const response = await fetch(apiUrl, {
            method: 'PUT',
            headers: {
                'Authorization': `token ${token}`,
                'Content-Type': 'application/json',
                'Accept': 'application/vnd.github.v3+json'
            },
            body: JSON.stringify({
                message: `–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö: ${new Date().toLocaleString('ru-RU')}`,
                content: btoa(unescape(encodeURIComponent(content))),
                sha: sha
            })
        });
        
        if (response.ok) {
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É
            closeGitHubModal();
            
            // –ü—Ä–æ—Å—Ç–æ –∑–µ–ª–µ–Ω–∞—è –Ω–∞–¥–ø–∏—Å—å
            const success = document.createElement('div');
            success.className = 'fixed top-4 right-4 bg-emerald-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
            success.textContent = '‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ';
            document.body.appendChild(success);
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                success.remove();
            }, 3000);
            
        } else {
            const error = await response.json();
            alert(`–û—à–∏–±–∫–∞: ${error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);
            document.getElementById('githubTokenInput').focus();
        }
        
    } catch (error) {
        alert(`–û—à–∏–±–∫–∞: ${error.message}`);
        document.getElementById('githubTokenInput').focus();
    }
}
// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
function showNotification(message, type = 'info') {
    // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 transform transition-all duration-300 ${
        type === 'success' ? 'bg-emerald-500 text-white' :
        type === 'error' ? 'bg-red-500 text-white' :
        type === 'warning' ? 'bg-amber-500 text-white' :
        'bg-brand-600 text-white'
    }`;
    notification.innerHTML = `
        <div class="flex items-center gap-2">
            <span class="font-medium">${message}</span>
            <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-white/80">&times;</button>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
    setTimeout(() => {
        if (notification.parentElement) {
            notification.style.opacity = '0';
            notification.style.transform = 'translateX(100%)';
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 300);
        }
    }, 5000);
}
     

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ù–ü–ê
        let appData = [];
        let currentDocFilter = null;
        let currentTypeFilter = null;
        let currentTargetFilter = null;
        let selectedIds = new Set();
        let editId = null;
        let chartInstance = null;

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –¥–∞—à–±–æ—Ä–¥–æ–≤
        let dashboardsData = [];
        let currentStatusFilterDashboards = null;
        let currentTypeFilterDashboards = null;
        let currentTagFilterDashboards = null;
        let selectedIdsDashboards = new Set();
        let editIdDashboards = null;
        let chartInstanceDashboards = null;

        // –¢–µ–∫—É—â–∞—è –∞–∫—Ç–∏–≤–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞
        let currentTab = 'npas';

        // ============== –û–ë–™–ï–î–ò–ù–ï–ù–ù–´–ï JSON –§–£–ù–ö–¶–ò–ò ==============
        function exportJson() {
            const allData = {
                version: "1.0",
                exportDate: new Date().toISOString(),
                npas: appData,
                dashboards: dashboardsData,
                metadata: {
                    npaCount: appData.length,
                    dashboardsCount: dashboardsData.length,
                    exportFormat: "combined"
                }
            };
            
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(allData, null, 2));
            const a = document.createElement('a');
            a.href = dataStr;
           a.download = `gko_all_data.json`;
            a.click();
        }

        function importJson() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const json = JSON.parse(e.target.result);
                        
                        let confirmMessage = "–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞?\n\n";
                        let hasNPA = false;
                        let hasDashboards = false;
                        
                        if (json.npas && Array.isArray(json.npas)) {
                            confirmMessage += `–ù–ü–ê: ${json.npas.length} –∑–∞–ø–∏—Å–µ–π\n`;
                            hasNPA = true;
                        }
                        
                        if (json.dashboards && Array.isArray(json.dashboards)) {
                            confirmMessage += `–î–∞—à–±–æ—Ä–¥—ã: ${json.dashboards.length} –∑–∞–ø–∏—Å–µ–π\n`;
                            hasDashboards = true;
                        }
                        
                        if (json.version && json.version === "1.0" && json.exportFormat === "combined") {
                            confirmMessage += "\n–§–æ—Ä–º–∞—Ç: –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Ñ–∞–π–ª";
                        } else if (Array.isArray(json) && json.length > 0 && json[0].doc) {
                            confirmMessage = `–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å ${json.length} –∑–∞–ø–∏—Å–µ–π –ù–ü–ê?`;
                            hasNPA = true;
                            hasDashboards = false;
                        } else if (Array.isArray(json) && json.length > 0 && json[0].title) {
                            confirmMessage = `–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å ${json.length} –¥–∞—à–±–æ—Ä–¥–æ–≤?`;
                            hasNPA = false;
                            hasDashboards = true;
                        }
                        
                        if (confirm(confirmMessage)) {
                            if (hasNPA) {
                                const npaData = json.npas || json;
                                appData = [...npaData];
                                saveData();
                            }
                            
                            if (hasDashboards) {
                                const dashData = json.dashboards || json;
                                dashboardsData = [...dashData];
                                saveDashboardsData();
                            }
                            
                            alert("–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!");
                        }
                    } catch(e) {
                        alert("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è JSON —Ñ–∞–π–ª–∞: " + e.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // ============== –û–ë–©–ò–ï –§–£–ù–ö–¶–ò–ò ==============
function switchTab(tabName) {
    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –≤–∫–ª–∞–¥–æ–∫
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—É—é
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    document.getElementById(`${tabName}Tab`).classList.add('active');
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –∏–º–ø–æ—Ä—Ç–∞/–¥–æ–±–∞–≤–ª–µ–Ω–∏—è
    if (tabName === 'npas') {
        document.getElementById('npaImportButtons').classList.remove('hidden');
        document.getElementById('dashboardsImportButtons').classList.add('hidden');
        document.getElementById('addButtonText').textContent = '–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å';
        document.getElementById('resetBtnText').textContent = '–°–±—Ä–æ—Å –ù–ü–ê';
        currentTab = 'npas';
        // –°–∫—Ä—ã–≤–∞–µ–º —Ç—É–ª–±–∞—Ä –¥–∞—à–±–æ—Ä–¥–æ–≤, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç—É–ª–±–∞—Ä –ù–ü–ê
        document.getElementById('bulkToolbarDashboards').classList.add('hidden');
        if (selectedIds.size > 0) {
            document.getElementById('bulkToolbar').classList.remove('hidden');
        }
    } else {
        document.getElementById('npaImportButtons').classList.add('hidden');
        document.getElementById('dashboardsImportButtons').classList.remove('hidden');
        document.getElementById('addButtonText').textContent = '–ù–æ–≤—ã–π –¥–∞—à–±–æ—Ä–¥';
        document.getElementById('resetBtnText').textContent = '–°–±—Ä–æ—Å –¥–∞—à–±–æ—Ä–¥–æ–≤';
        currentTab = 'dashboards';
        // –°–∫—Ä—ã–≤–∞–µ–º —Ç—É–ª–±–∞—Ä –ù–ü–ê, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç—É–ª–±–∞—Ä –¥–∞—à–±–æ—Ä–¥–æ–≤
        document.getElementById('bulkToolbar').classList.add('hidden');
        if (selectedIdsDashboards.size > 0) {
            document.getElementById('bulkToolbarDashboards').classList.remove('hidden');
        }
        
        // –ì–ê–†–ê–ù–¢–ò–†–û–í–ê–ù–ù–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –í–ö–õ–ê–î–ö–ò –î–ê–®–ë–û–†–î–û–í
        // 1. –°–Ω–∞—á–∞–ª–∞ —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
        if (dashboardsData.length === 0) {
            loadDashboardsData(); // –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
        }
        
        // 2. –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ, —á—Ç–æ–±—ã –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è, –∑–∞—Ç–µ–º —Ä–µ–Ω–¥–µ—Ä–∏–º
        setTimeout(() => {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            updateDashboardStatsDashboards();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
            renderStatusFiltersDashboards();
            renderTypeFiltersDashboards();
            renderTagsDashboards();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫
            updateChartDashboards(dashboardsData);
            
            // –ò –≥–ª–∞–≤–Ω–æ–µ - —Ä–µ–Ω–¥–µ—Ä–∏–º –≥—Ä–∏–¥ –∫–∞—Ä—Ç–æ—á–µ–∫
            renderDashboardsGrid();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç—É–ª–±–∞—Ä –º–∞—Å—Å–æ–≤–æ–≥–æ –≤—ã–±–æ—Ä–∞
            updateBulkToolbarDashboards();
            
            console.log('–í–∫–ª–∞–¥–∫–∞ –¥–∞—à–±–æ—Ä–¥–æ–≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞, –¥–∞–Ω–Ω—ã—Ö:', dashboardsData.length);
        }, 50);
    }
}

        function hardResetCurrent() {
            if (currentTab === 'npas') {
                hardResetNPA();
            } else {
                hardResetDashboards();
            }
        }
        function initializeDashboardsTab() {
            if (dashboardsData.length === 0) {
                loadDashboardsData();
            } else {
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –≤–∫–ª–∞–¥–∫–∏
                updateDashboardStatsDashboards();
                renderStatusFiltersDashboards();
                renderTypeFiltersDashboards();
                renderTagsDashboards();
                updateChartDashboards(dashboardsData);
                renderDashboardsGrid();
            }
        }
        // ============== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ù–ü–ê ==============
function loadData() {
    const saved = localStorage.getItem(STORAGE_KEY_NPA);
    if (saved) {
        try {
            appData = JSON.parse(saved);
        } catch (e) { 
            appData = []; // –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –≤–º–µ—Å—Ç–æ initialData
        }
    } else {
        appData = []; // –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –≤–º–µ—Å—Ç–æ initialData
    }
    renderGrid();
}


        function saveData() {
            localStorage.setItem(STORAGE_KEY_NPA, JSON.stringify(appData));
            renderGrid();
        }

        function setDocFilter(val) { currentDocFilter = currentDocFilter === val ? null : val; renderGrid(); }
        function setTypeFilter(val) { currentTypeFilter = currentTypeFilter === val ? null : val; renderGrid(); }
        function setTargetFilter(val) { currentTargetFilter = currentTargetFilter === val ? null : val; renderGrid(); }
        function resetAllFilters() { currentDocFilter = null; currentTypeFilter = null; currentTargetFilter = null; document.getElementById('searchInput').value=''; renderGrid(); }

        function renderGrid() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const sortMode = document.getElementById('sortSelect').value;
            
            let filtered = appData.filter(item => {
                const matchesDoc = !currentDocFilter || item.doc === currentDocFilter;
                const matchesType = !currentTypeFilter || item.type === currentTypeFilter;
                const matchesTarget = !currentTargetFilter || (item.target && item.target.includes(currentTargetFilter));
                const matchesSearch = 
                    (item.human && item.human.toLowerCase().includes(search)) || 
                    (item.norm && item.norm.toLowerCase().includes(search)) || 
                    (item.doc && item.doc.toLowerCase().includes(search));
                return matchesDoc && matchesType && matchesTarget && matchesSearch;
            });

            filtered.sort((a, b) => {
                if (sortMode === 'dateDesc') return parseDate(b.date) - parseDate(a.date);
                if (sortMode === 'dateAsc') return parseDate(a.date) - parseDate(b.date);
                if (sortMode === 'lastUpdated') return (b.updated || 0) - (a.updated || 0);
                return a.id - b.id;
            });

            renderDocFilters();
            renderTypeFilters();
            renderTags();
            updateActiveBar();
            updateDashboard(filtered);

            const container = document.getElementById('cardsGrid');
            container.innerHTML = '';

            document.getElementById('filteredCount').innerText = filtered.length;

            if (filtered.length === 0) {
                container.innerHTML = `<div class="text-center py-12 text-slate-400">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>`;
                return;
            }

            filtered.forEach(item => {
                const isSelected = selectedIds.has(item.id);
                const badgeColor = getBadgeColor(item.doc);
                const typeColor = getTypeColor(item.type);
                const updateDate = item.updated ? new Date(item.updated).toLocaleString('ru-RU', { 
                    day: '2-digit', month: '2-digit', year: 'numeric', 
                    hour: '2-digit', minute: '2-digit' 
                }) : '‚Äî';

                const div = document.createElement('div');
                div.className = `bg-white rounded-2xl shadow-sm border ${isSelected ? 'border-brand-500 ring-2 ring-brand-200' : 'border-slate-200'} p-5 card-anim relative group hover:border-brand-300`;
                div.innerHTML = `
                    <div class="absolute top-5 left-5 z-10">
                        <input type="checkbox" class="custom-checkbox" onchange="toggleSelection('${item.id}')" ${isSelected ? 'checked' : ''}>
                    </div>
                    <div class="pl-10">
                        <div class="flex flex-wrap justify-between items-start gap-2 mb-3">
                            <div class="flex flex-wrap items-center gap-2">
                                <span class="text-[10px] font-extrabold px-2 py-1 rounded-md ${badgeColor} uppercase tracking-wider cursor-pointer hover:opacity-80" onclick="setDocFilter('${item.doc}')">${item.doc}</span>
                                <span class="text-[10px] font-bold px-2 py-1 rounded-md ${typeColor} uppercase tracking-wider cursor-pointer hover:opacity-80" onclick="setTypeFilter('${item.type}')">${item.type}</span>
                            </div>
                            <div class="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                <button onclick="editItem(${item.id})" class="p-1 hover:bg-slate-100 rounded text-slate-400 hover:text-brand-600">‚úèÔ∏è</button>
                                <button onclick="deleteItem(${item.id})" class="p-1 hover:bg-slate-100 rounded text-slate-400 hover:text-red-500">üóëÔ∏è</button>
                            </div>
                        </div>
                        <h3 class="font-bold text-lg text-slate-800 mb-3">${item.norm}</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                            <div class="bg-red-50 p-2.5 rounded-lg border border-red-100 text-sm text-slate-600">
                                <strong class="block text-[10px] text-red-400 uppercase">–ë—ã–ª–æ</strong>${item.before}
                            </div>
                            <div class="bg-emerald-50 p-2.5 rounded-lg border border-emerald-100 text-sm text-slate-800 font-medium">
                                <strong class="block text-[10px] text-emerald-600 uppercase">–°—Ç–∞–ª–æ</strong>${item.after}
                            </div>
                        </div>
                        <p class="text-slate-600 text-sm mb-3">${item.human}</p>
                        ${item.example ? `<div class="text-xs text-slate-500 bg-slate-50 p-2 rounded border-l-2 border-brand-200 mb-3 italic">"${item.example}"</div>` : ''}
                        
                        <div class="flex items-center gap-2 mt-2 flex-wrap">
                            ${(item.target||'').split(',').map(t => `<span class="text-[10px] font-bold text-slate-400 bg-slate-100 px-2 py-0.5 rounded-full cursor-pointer hover:bg-brand-100 hover:text-brand-700 transition" onclick="setTargetFilter('${t.trim()}')">#${t.trim()}</span>`).join('')}
                        </div>

                        <!-- Footer Info -->
                        <div class="mt-4 pt-3 border-t border-slate-100 flex flex-wrap justify-between items-center text-xs text-slate-400">
                           <div class="flex gap-3">
                                <span title="–û—Å–Ω–æ–≤–∞–Ω–∏–µ">üìÑ ${item.changeDoc || '‚Äî'}</span>
                                <span title="–î–∞—Ç–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è" class="text-slate-600 font-bold">üìÖ ${item.date || '‚Äî'}</span>
                           </div>
                           <div class="flex items-center gap-3">
                                <span title="–û–±–Ω–æ–≤–ª–µ–Ω–æ –≤ –±–∞–∑–µ">üîÑ ${updateDate}</span>
                                <button onclick="toggleCardText('${item.id}')" class="text-brand-600 font-bold hover:underline">–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π —Ç–µ–∫—Å—Ç ‚ñº</button>
                           </div>
                        </div>
                        
                        <!-- Collapsible Legal Text -->
                        <div id="legal-${item.id}" class="hidden mt-3 pt-3 border-t border-dashed border-slate-200 grid grid-cols-1 md:grid-cols-2 gap-4 text-xs font-mono bg-slate-50 p-3 rounded-lg">
                            <div><strong class="block text-slate-400 uppercase mb-1">–°—Ç–∞—Ä–∞—è —Ä–µ–¥.</strong>${item.fullOld || "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö"}</div>
                            <div><strong class="block text-emerald-600 uppercase mb-1">–ù–æ–≤–∞—è —Ä–µ–¥.</strong>${item.fullNew || "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö"}</div>
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
            updateBulkToolbar();
        }

        function updateDashboard(dataSource) {
            const data = dataSource || appData;
            const total = data.length;
            document.getElementById('statTotal').innerText = total;

            const countFZ = data.filter(i => i.doc.includes('237')).length;
            const countOrder = data.filter(i => i.doc.includes('0336')).length;
            const countNK = data.filter(i => i.doc.includes('378') || i.doc.includes('NK')).length;

            document.getElementById('countFZ').innerText = countFZ;
            document.getElementById('countOrder').innerText = countOrder;
            document.getElementById('countNK').innerText = countNK;

            document.getElementById('barFZ').style.width = (total ? (countFZ/total*100) : 0) + '%';
            document.getElementById('barOrder').style.width = (total ? (countOrder/total*100) : 0) + '%';
            document.getElementById('barNK').style.width = (total ? (countNK/total*100) : 0) + '%';
            
            const typeCounts = {};
            data.forEach(i => { typeCounts[i.type] = (typeCounts[i.type] || 0) + 1; });
            const sortedKeys = Object.keys(typeCounts).sort((a,b) => typeCounts[b] - typeCounts[a]);
            const sortedData = sortedKeys.map(k => typeCounts[k]);
            
            const ctx = document.getElementById('typeChart').getContext('2d');
            if (chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedKeys,
                    datasets: [{
                        label: '–ó–∞–ø–∏—Å–µ–π',
                        data: sortedData,
                        backgroundColor: '#3b82f6',
                        borderRadius: 4,
                        barThickness: 20
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { display: false }, ticks: { precision: 0 } },
                        y: { grid: { display: false } }
                    },
                    onClick: (e, els) => {
                        if(els.length > 0) {
                            const index = els[0].index;
                            setTypeFilter(sortedKeys[index]);
                        }
                    }
                }
            });
        }

        function renderDocFilters() {
            const container = document.getElementById('docFilterContainer');
            const docs = [...new Set(appData.map(item => item.doc))];
            container.innerHTML = docs.map(doc => {
                const isActive = currentDocFilter === doc;
                return `<button onclick="setDocFilter('${doc}')" class="filter-chip px-3 py-1.5 rounded-lg text-xs font-bold border ${isActive ? 'active' : 'bg-white border-slate-200 text-slate-500'}">${doc}</button>`;
            }).join('');
        }

        function renderTypeFilters() {
            const container = document.getElementById('typeFilterContainer');
            const types = [...new Set(appData.map(item => item.type))];
            container.innerHTML = types.map(t => {
                const isActive = currentTypeFilter === t;
                return `<button onclick="setTypeFilter('${t}')" class="filter-chip px-3 py-1.5 rounded-lg text-xs font-bold border ${isActive ? 'active' : 'bg-white border-slate-200 text-slate-500'}">${t}</button>`;
            }).join('');
        }

        function renderTags() {
            const container = document.getElementById('targetContainer');
            const counts = {}; appData.forEach(i => (i.target||'').split(',').forEach(t => { const k=t.trim(); if(k) counts[k]=(counts[k]||0)+1; }));
            container.innerHTML = Object.keys(counts).map(k => {
                const isActive = currentTargetFilter === k;
                return `<button onclick="setTargetFilter('${k}')" class="filter-chip px-3 py-1 border rounded-full text-xs ${isActive ? 'active' : 'bg-white text-slate-500 border-slate-200'}">${k} <span class="opacity-60 ml-1">${counts[k]}</span></button>`;
            }).join('');
        }

        function updateActiveBar() {
            const bar = document.getElementById('activeFiltersBar');
            if(currentDocFilter || currentTypeFilter || currentTargetFilter) bar.classList.remove('hidden'); else bar.classList.add('hidden');
        }

        function openModal() {
            if (currentTab === 'npas') {
                openModalNPA();
            } else {
                openModalDashboards();
            }
        }

        function openModalNPA() {
            editId = null;
            document.getElementById('modalTitle').innerText = "–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å";
            document.querySelectorAll('#modalContent input, #modalContent textarea').forEach(e => e.value = '');
            const docs = [...new Set(appData.map(i => i.doc))];
            document.getElementById('docSuggestions').innerHTML = docs.map(d => `<option value="${d}">`).join('');
            toggleModal(true);
        }

        function editItem(id) {
            const item = appData.find(i => i.id === id); if (!item) return;
            editId = id;
            document.getElementById('modalTitle').innerText = "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ";
            const docs = [...new Set(appData.map(i => i.doc))];
            document.getElementById('docSuggestions').innerHTML = docs.map(d => `<option value="${d}">`).join('');
            
            document.getElementById('editDoc').value = item.doc; 
            document.getElementById('editNorm').value = item.norm;
            document.getElementById('editType').value = item.type; 
            document.getElementById('editTarget').value = item.target;
            document.getElementById('editBefore').value = item.before; 
            document.getElementById('editAfter').value = item.after;
            document.getElementById('editHuman').value = item.human; 
            document.getElementById('editExample').value = item.example||'';
            document.getElementById('editFullOld').value = item.fullOld||''; 
            document.getElementById('editFullNew').value = item.fullNew||'';
            document.getElementById('editChangeDoc').value = item.changeDoc||''; 
            document.getElementById('editDate').value = item.date||'';
            toggleModal(true);
        }

        function saveItem() {
            const doc = document.getElementById('editDoc').value;
            const norm = document.getElementById('editNorm').value;
            if(!doc || !norm) return alert("–î–æ–∫—É–º–µ–Ω—Ç –∏ –ù–æ—Ä–º–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã");

            const newItem = {
                id: editId || Date.now(),
                doc: doc, norm: norm,
                type: document.getElementById('editType').value,
                target: document.getElementById('editTarget').value,
                before: document.getElementById('editBefore').value,
                after: document.getElementById('editAfter').value,
                human: document.getElementById('editHuman').value,
                example: document.getElementById('editExample').value,
                fullOld: document.getElementById('editFullOld').value,
                fullNew: document.getElementById('editFullNew').value,
                changeDoc: document.getElementById('editChangeDoc').value,
                date: document.getElementById('editDate').value,
                updated: Date.now()
            };

            if (editId) {
                const idx = appData.findIndex(i => i.id === editId);
                if (idx > -1) appData[idx] = newItem;
            } else {
                appData.unshift(newItem);
            }
            toggleModal(false);
            saveData();
        }

        function deleteItem(id) { if(confirm("–£–¥–∞–ª–∏—Ç—å?")) { appData = appData.filter(i => i.id !== id); selectedIds.delete(id); saveData(); } }
        function toggleModal(show) { const m = document.getElementById('modal'); if(show) { m.classList.remove('hidden'); setTimeout(()=>m.classList.remove('opacity-0'),10); } else { m.classList.add('opacity-0'); setTimeout(()=>m.classList.add('hidden'),300); } }
        function closeModal() { toggleModal(false); }
        function getBadgeColor(doc) {
            if(doc.includes("237")) return "bg-indigo-100 text-indigo-700";
            if(doc.includes("0336")) return "bg-sky-100 text-sky-700";
            if(doc.includes("378") || doc.includes("NK")) return "bg-amber-100 text-amber-800";
            return "bg-slate-100 text-slate-700";
        }
        function getTypeColor(type) {
            if(type === '–¶–∏—Ñ—Ä–∞') return 'bg-purple-100 text-purple-700';
            if(type === '–§–∏–Ω–∞–Ω—Å—ã') return 'bg-emerald-100 text-emerald-700';
            if(type === '–ö–æ–Ω—Ç—Ä–æ–ª—å') return 'bg-rose-100 text-rose-700';
            return 'bg-slate-100 text-slate-600';
        }
        function parseDate(d) { if (!d) return 0; const p = d.split('.'); return p.length === 3 ? new Date(p[2], p[1]-1, p[0]).getTime() : 0; }
        
        function toggleSelection(idStr) { const id = parseInt(idStr); if (selectedIds.has(id)) selectedIds.delete(id); else selectedIds.add(id); updateBulkToolbar(); renderGrid(); }
        function toggleSelectAll() {
            const visibleIds = Array.from(document.querySelectorAll('#cardsGrid .custom-checkbox')).map(cb => parseInt(cb.getAttribute('onchange').match(/\d+/)[0]));
            const allSelected = visibleIds.every(id => selectedIds.has(id));
            visibleIds.forEach(id => { if(allSelected) selectedIds.delete(id); else selectedIds.add(id); });
            updateBulkToolbar(); renderGrid();
        }
        function clearSelection() { selectedIds.clear(); updateBulkToolbar(); renderGrid(); }
        function updateBulkToolbar() { 
            const el = document.getElementById('bulkToolbar'); 
            document.getElementById('bulkCount').innerText = selectedIds.size; 
            if (selectedIds.size > 0 && currentTab === 'npas') {
                el.classList.remove('hidden');
            } else {
                el.classList.add('hidden');
            }
        }
        function bulkDelete() { if(confirm(`–£–¥–∞–ª–∏—Ç—å ${selectedIds.size} –∑–∞–ø–∏—Å–µ–π?`)) { appData = appData.filter(i => !selectedIds.has(i.id)); clearSelection(); saveData(); } }
        function openBulkEditModal() { document.getElementById('bulkModal').classList.remove('hidden'); setTimeout(()=>document.getElementById('bulkModal').classList.remove('opacity-0'),10); }
        function closeBulkModal() { document.getElementById('bulkModal').classList.add('opacity-0'); setTimeout(()=>document.getElementById('bulkModal').classList.add('hidden'),300); }
        function applyBulkEdit() {
            const type = document.getElementById('bulkType').value; const changeDoc = document.getElementById('bulkChangeDoc').value;
            appData = appData.map(i => { if (selectedIds.has(i.id)) { if(type) i.type = type; if(changeDoc) i.changeDoc = changeDoc; i.updated = Date.now(); } return i; });
            closeBulkModal(); clearSelection(); saveData();
        }

        function hardResetNPA() { 
            if(confirm("–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ù–ü–ê? –í—Å–µ —Ç–µ–∫—É—â–∏–µ –∑–∞–ø–∏—Å–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.")) { 
                localStorage.removeItem(STORAGE_KEY_NPA); 
                loadData();
            } 
        }

        // ============== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –î–ê–®–ë–û–†–î–û–í ==============
function loadDashboardsData() {
    const saved = localStorage.getItem(STORAGE_KEY_DASHBOARDS);
    if (saved) {
        try {
            dashboardsData = JSON.parse(saved);
        } catch (e) { 
            dashboardsData = []; // –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –≤–º–µ—Å—Ç–æ initialDashboards
        }
    } else {
        dashboardsData = []; // –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –≤–º–µ—Å—Ç–æ initialDashboards
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ —Ñ–∏–ª—å—Ç—Ä—ã
    updateDashboardStatsDashboards();
    renderStatusFiltersDashboards();
    renderTypeFiltersDashboards();
    renderTagsDashboards();
    
    if (currentTab === 'dashboards') {
        renderDashboardsGrid();
    } else {
        updateChartDashboards(dashboardsData);
    }
}

        function saveDashboardsData() {
            localStorage.setItem(STORAGE_KEY_DASHBOARDS, JSON.stringify(dashboardsData));
            renderDashboardsGrid();
        }

        function setStatusFilterDashboards(val) { 
            currentStatusFilterDashboards = currentStatusFilterDashboards === val ? null : val; 
            renderDashboardsGrid(); 
        }

        function setTypeFilterDashboards(val) { 
            currentTypeFilterDashboards = currentTypeFilterDashboards === val ? null : val; 
            renderDashboardsGrid(); 
        }

        function setTagFilterDashboards(val) { 
            currentTagFilterDashboards = currentTagFilterDashboards === val ? null : val; 
            renderDashboardsGrid(); 
        }

        function resetAllDashboardsFilters() { 
            currentStatusFilterDashboards = null; 
            currentTypeFilterDashboards = null; 
            currentTagFilterDashboards = null; 
            document.getElementById('searchInputDashboards').value=''; 
            renderDashboardsGrid(); 
        }

function renderDashboardsGrid() {
    const search = document.getElementById('searchInputDashboards').value.toLowerCase();
    const sortMode = document.getElementById('sortSelectDashboards').value;
    
    let filtered = dashboardsData.filter(item => {
        const matchesStatus = !currentStatusFilterDashboards || item.status === currentStatusFilterDashboards;
        const matchesType = !currentTypeFilterDashboards || item.analysisType === currentTypeFilterDashboards;
        const matchesTag = !currentTagFilterDashboards || (item.tags && item.tags.some(tag => tag.toLowerCase() === currentTagFilterDashboards.toLowerCase()));
        const matchesSearch = 
            (item.title && item.title.toLowerCase().includes(search)) || 
            (item.description && item.description.toLowerCase().includes(search)) ||
            (item.owner && item.owner.toLowerCase().includes(search)) ||
            (item.tags && item.tags.some(tag => tag.toLowerCase().includes(search)));
        
        return matchesStatus && matchesType && matchesTag && matchesSearch;
    });

    filtered.sort((a, b) => {
        switch(sortMode) {
            case 'nameAsc': return a.title.localeCompare(b.title);
            case 'nameDesc': return b.title.localeCompare(a.title);
            case 'createdDesc': return (b.createdDate || 0) - (a.createdDate || 0);
            case 'createdAsc': return (a.createdDate || 0) - (b.createdDate || 0);
            default: return (b.createdDate || 0) - (a.createdDate || 0);
        }
    });

    renderStatusFiltersDashboards();
    renderTypeFiltersDashboards();
    renderTagsDashboards();
    updateActiveBarDashboards();
    updateDashboardStatsDashboards(filtered);
    updateChartDashboards(filtered);

    const container = document.getElementById('cardsGridDashboards');
    container.innerHTML = '';
    document.getElementById('filteredCountDashboards').innerText = filtered.length;

    if (filtered.length === 0) {
        container.innerHTML = `
            <div class="col-span-2 text-center py-12 text-slate-400">
                <svg class="w-16 h-16 mx-auto text-slate-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <p class="text-lg font-medium mb-2">–î–∞—à–±–æ—Ä–¥—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                <p class="text-sm">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ <button onclick="resetAllDashboardsFilters()" class="text-brand-600 underline">—Å–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button></p>
            </div>
        `;
        return;
    }

    filtered.forEach(item => {
        const isSelected = selectedIdsDashboards.has(item.id);
        const statusColor = getStatusColorDashboards(item.status);
        const typeColor = getTypeColorDashboards(item.analysisType);
        const createdDate = item.createdDate ? new Date(item.createdDate).toLocaleDateString('ru-RU', { 
            day: '2-digit', month: '2-digit', year: 'numeric'
        }) : '‚Äî';
        
        const tagsHtml = item.tags ? item.tags.map(tag => 
            `<span class="text-[10px] font-bold text-slate-400 bg-slate-100 px-2 py-0.5 rounded-full cursor-pointer hover:bg-brand-100 hover:text-brand-700 transition" onclick="setTagFilterDashboards('${tag}')">#${tag}</span>`
        ).join('') : '';

        const card = document.createElement('div');
        card.className = `bg-white rounded-2xl shadow-sm border ${isSelected ? 'border-brand-500 ring-2 ring-brand-200' : 'border-slate-200'} p-5 card-anim dashboard-card hover:border-superset-300 group relative`;
        card.innerHTML = `
            <div class="absolute top-5 left-5 z-10">
                <input type="checkbox" class="custom-checkbox" onchange="toggleSelectionDashboards(${item.id})" ${isSelected ? 'checked' : ''}>
            </div>
            <div class="pl-10">
                <div class="flex flex-wrap justify-between items-start gap-2 mb-3">
                    <div class="flex flex-wrap items-center gap-2">
                        <span class="status-badge ${statusColor}">${getStatusTextDashboards(item.status)}</span>
                        <span class="text-[10px] font-bold px-2 py-1 rounded-md ${typeColor} uppercase tracking-wider">${getTypeTextDashboards(item.analysisType)}</span>
                    </div>
                </div>
                
                <h3 class="font-bold text-lg text-slate-800 mb-2">${item.title}</h3>
                
                <div class="mb-3">
                    <a href="${item.url}" target="_blank" class="text-sm text-superset-600 hover:text-superset-700 font-medium break-all">
                        <svg class="w-3 h-3 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                        </svg>
                        ${item.url.replace('https://', '').replace('http://', '')}
                    </a>
                </div>
                
                <p class="text-slate-600 text-sm mb-4">${item.description}</p>
                
                <div class="flex items-center gap-2 mb-3 flex-wrap">
                    ${tagsHtml}
                </div>
                
                <!-- –ú–µ—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                <div class="mt-4 pt-3 border-t border-slate-100 grid grid-cols-2 gap-3 text-xs text-slate-500">
                    <div>
                        <div class="flex items-center gap-1">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                            </svg>
                            <span class="font-medium">${item.owner || '–ù–µ —É–∫–∞–∑–∞–Ω'}</span>
                        </div>
                    </div>
                    <div class="text-right">
                        <span class="px-2 py-0.5 bg-slate-100 rounded text-[10px] font-medium">${getFrequencyTextDashboards(item.updateFrequency)}</span>
                    </div>
                    <div class="col-span-2">
                        <div class="flex items-center gap-1">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <span>–°–æ–∑–¥–∞–Ω: ${createdDate}</span>
                        </div>
                    </div>
                </div>
                
                <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É -->
                <div class="absolute bottom-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex gap-1">
                    <button onclick="openDashboard('${item.url}')" class="p-2 hover:bg-slate-100 rounded-lg text-slate-400 hover:text-superset-600 transition-colors" title="–û—Ç–∫—Ä—ã—Ç—å">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                        </svg>
                    </button>
                    <button onclick="editDashboard(${item.id})" class="p-2 hover:bg-slate-100 rounded-lg text-slate-400 hover:text-brand-600 transition-colors" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                        </svg>
                    </button>
                    <button onclick="deleteDashboard(${item.id})" class="p-2 hover:bg-slate-100 rounded-lg text-slate-400 hover:text-red-500 transition-colors" title="–£–¥–∞–ª–∏—Ç—å">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 011.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                    </button>
                </div>
            </div>
        `;
        container.appendChild(card);
    });
    
    updateBulkToolbarDashboards();
}

        function updateDashboardStatsDashboards(filteredData = dashboardsData) {
            const total = dashboardsData.length;
            const active = dashboardsData.filter(d => d.status === 'active').length;
            
            const analytical = filteredData.filter(d => d.analysisType === 'analytical').length;
            const monitoring = filteredData.filter(d => d.analysisType === 'monitoring').length;
            const operational = filteredData.filter(d => d.analysisType === 'operational').length;
            const reporting = filteredData.filter(d => d.analysisType === 'reporting').length;
            
            document.getElementById('statTotalDashboards').innerText = total;
            document.getElementById('statActiveDashboards').innerText = active;
            document.getElementById('countAnalytical').innerText = analytical;
            document.getElementById('countMonitoring').innerText = monitoring;
            document.getElementById('countOperational').innerText = operational;
            document.getElementById('countReporting').innerText = reporting;
        }

        function updateChartDashboards(filteredData) {
            const typeCounts = {};
            filteredData.forEach(d => { 
                const type = getTypeTextDashboards(d.analysisType);
                typeCounts[type] = (typeCounts[type] || 0) + 1; 
            });
            
            const sortedTypes = Object.keys(typeCounts).sort((a, b) => typeCounts[b] - typeCounts[a]);
            const counts = sortedTypes.map(type => typeCounts[type]);
            
            const ctx = document.getElementById('typeChartDashboards').getContext('2d');
            if (chartInstanceDashboards) chartInstanceDashboards.destroy();
            
            const colors = {
                '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞': '#8b5cf6',
                '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥': '#3b82f6',
                '–û–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ': '#10b981',
                '–û—Ç—á–µ—Ç–Ω–æ—Å—Ç—å': '#f43f5e',
                '–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ': '#f59e0b',
                '–î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ì–ë–£': '#4f46e5'
            };
            
            const backgroundColors = sortedTypes.map(type => colors[type] || '#94a3b8');
            
            chartInstanceDashboards = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: sortedTypes,
                    datasets: [{
                        data: counts,
                        backgroundColor: backgroundColors,
                        borderWidth: 1,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    plugins: { 
                        legend: { 
                            position: 'right',
                            labels: {
                                boxWidth: 12,
                                padding: 15,
                                font: {
                                    size: 11
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    onClick: (e, els) => {
                        if (els.length > 0) {
                            const index = els[0].index;
                            const typeKey = getTypeKeyFromText(sortedTypes[index]);
                            if (typeKey) {
                                setTypeFilterDashboards(typeKey);
                            }
                        }
                    }
                }
            });
        }

        function getTypeKeyFromText(typeText) {
            const mapping = {
                '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞': 'analytical',
                '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥': 'monitoring',
                '–û–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ': 'operational',
                '–û—Ç—á–µ—Ç–Ω–æ—Å—Ç—å': 'reporting',
                '–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ': 'forecast',
                '–î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ì–ë–£': 'gbuegbu'
            };
            return mapping[typeText] || null;
        }

        function renderStatusFiltersDashboards() {
            const container = document.getElementById('statusFilterContainerDashboards');
            const statuses = ['active', 'draft', 'archived'];
            container.innerHTML = statuses.map(status => {
                const isActive = currentStatusFilterDashboards === status;
                const count = dashboardsData.filter(d => d.status === status).length;
                return `
                    <button onclick="setStatusFilterDashboards('${status}')" 
                            class="filter-chip px-3 py-1.5 rounded-lg text-xs font-bold border ${isActive ? 'active' : 'bg-white border-slate-200 text-slate-500'}">
                        ${getStatusTextDashboards(status)} <span class="ml-1 opacity-70">(${count})</span>
                    </button>
                `;
            }).join('');
        }

        function renderTypeFiltersDashboards() {
            const container = document.getElementById('typeFilterContainerDashboards');
            const types = [...new Set(dashboardsData.map(d => d.analysisType))];
            container.innerHTML = types.map(type => {
                const isActive = currentTypeFilterDashboards === type;
                const count = dashboardsData.filter(d => d.analysisType === type).length;
                return `
                    <button onclick="setTypeFilterDashboards('${type}')" 
                            class="filter-chip px-3 py-1.5 rounded-lg text-xs font-bold border ${isActive ? 'active' : 'bg-white border-slate-200 text-slate-500'}">
                        ${getTypeTextDashboards(type)} <span class="ml-1 opacity-70">(${count})</span>
                    </button>
                `;
            }).join('');
        }

        function renderTagsDashboards() {
            const container = document.getElementById('tagsContainerDashboards');
            const tagCounts = {};
            
            dashboardsData.forEach(dashboard => {
                if (dashboard.tags && Array.isArray(dashboard.tags)) {
                    dashboard.tags.forEach(tag => {
                        tagCounts[tag] = (tagCounts[tag] || 0) + 1;
                    });
                }
            });
            
            const sortedTags = Object.keys(tagCounts).sort((a, b) => tagCounts[b] - tagCounts[a]);
            
            container.innerHTML = sortedTags.map(tag => {
                const isActive = currentTagFilterDashboards === tag;
                return `
                    <button onclick="setTagFilterDashboards('${tag}')" 
                            class="filter-chip px-3 py-1 border rounded-full text-xs ${isActive ? 'active' : 'bg-white text-slate-500 border-slate-200'}">
                        ${tag} <span class="opacity-60 ml-1">${tagCounts[tag]}</span>
                    </button>
                `;
            }).join('');
        }

        function updateActiveBarDashboards() {
            const bar = document.getElementById('activeFiltersBarDashboards');
            if (currentStatusFilterDashboards || currentTypeFilterDashboards || currentTagFilterDashboards) {
                bar.classList.remove('hidden');
            } else {
                bar.classList.add('hidden');
            }
        }

        function openModalDashboards() {
            editIdDashboards = null;
            document.getElementById('modalTitleDashboards').innerText = "–ù–æ–≤—ã–π –¥–∞—à–±–æ—Ä–¥";
            document.querySelectorAll('#modalContentDashboards input, #modalContentDashboards textarea, #modalContentDashboards select').forEach(e => {
                if (e.type !== 'hidden') e.value = '';
                if (e.tagName === 'SELECT') e.selectedIndex = 0;
            });
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('editCreatedDateDashboards').value = today;
            toggleModalDashboards(true);
        }

        function editDashboard(id) {
            const dashboard = dashboardsData.find(d => d.id === id);
            if (!dashboard) return;
            
            editIdDashboards = id;
            document.getElementById('modalTitleDashboards').innerText = "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–∞";
            
            document.getElementById('editIdDashboards').value = id;
            document.getElementById('editTitleDashboards').value = dashboard.title;
            document.getElementById('editUrlDashboards').value = dashboard.url;
            document.getElementById('editDescriptionDashboards').value = dashboard.description || '';
            document.getElementById('editAnalysisTypeDashboards').value = dashboard.analysisType;
            document.getElementById('editStatusDashboards').value = dashboard.status;
            document.getElementById('editOwnerDashboards').value = dashboard.owner || '';
            document.getElementById('editTagsDashboards').value = dashboard.tags ? dashboard.tags.join(', ') : '';
            
            if (dashboard.createdDate) {
                const date = new Date(dashboard.createdDate);
                const formattedDate = date.toISOString().split('T')[0];
                document.getElementById('editCreatedDateDashboards').value = formattedDate;
            } else {
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('editCreatedDateDashboards').value = today;
            }
            
            document.getElementById('editDataSourceDashboards').value = dashboard.dataSource || '';
            document.getElementById('editUpdateFrequencyDashboards').value = dashboard.updateFrequency || 'daily';
            document.getElementById('editNotesDashboards').value = dashboard.notes || '';
            
            toggleModalDashboards(true);
        }

        function saveDashboard() {
            const title = document.getElementById('editTitleDashboards').value.trim();
            const url = document.getElementById('editUrlDashboards').value.trim();
            
            if (!title || !url) {
                alert("–ù–∞–∑–≤–∞–Ω–∏–µ –∏ —Å—Å—ã–ª–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è");
                return;
            }
            
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                alert("–°—Å—ã–ª–∫–∞ –¥–æ–ª–∂–Ω–∞ –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å http:// –∏–ª–∏ https://");
                return;
            }
            
            const tags = document.getElementById('editTagsDashboards').value
                .split(',')
                .map(tag => tag.trim())
                .filter(tag => tag.length > 0);
            
            const createdDateInput = document.getElementById('editCreatedDateDashboards').value;
            const createdDate = createdDateInput ? new Date(createdDateInput).getTime() : Date.now();
            
            const newDashboard = {
                id: editIdDashboards || Date.now(),
                title: title,
                url: url,
                description: document.getElementById('editDescriptionDashboards').value.trim(),
                analysisType: document.getElementById('editAnalysisTypeDashboards').value,
                status: document.getElementById('editStatusDashboards').value,
                owner: document.getElementById('editOwnerDashboards').value.trim(),
                tags: tags,
                dataSource: document.getElementById('editDataSourceDashboards').value.trim(),
                updateFrequency: document.getElementById('editUpdateFrequencyDashboards').value,
                notes: document.getElementById('editNotesDashboards').value.trim(),
                createdDate: createdDate
            };
            
            if (editIdDashboards) {
                const index = dashboardsData.findIndex(d => d.id === editIdDashboards);
                if (index > -1) {
                    dashboardsData[index] = newDashboard;
                }
            } else {
                dashboardsData.unshift(newDashboard);
            }
            
            toggleModalDashboards(false);
            saveDashboardsData();
        }

        function getStatusColorDashboards(status) {
            switch(status) {
                case 'active': return 'status-active';
                case 'draft': return 'status-draft';
                case 'archived': return 'status-archived';
                default: return 'status-draft';
            }
        }

        function getStatusTextDashboards(status) {
            switch(status) {
                case 'active': return '–ê–∫—Ç–∏–≤–Ω—ã–π';
                case 'draft': return '–ß–µ—Ä–Ω–æ–≤–∏–∫';
                case 'archived': return '–ê—Ä—Ö–∏–≤–Ω—ã–π';
                default: return status;
            }
        }

        function getTypeColorDashboards(type) {
            switch(type) {
                case 'analytical': return 'bg-purple-100 text-purple-700';
                case 'monitoring': return 'bg-blue-100 text-blue-700';
                case 'operational': return 'bg-emerald-100 text-emerald-700';
                case 'reporting': return 'bg-rose-100 text-rose-700';
                case 'forecast': return 'bg-amber-100 text-amber-700';
                case 'audit': return 'bg-indigo-100 text-indigo-700';
                default: return 'bg-slate-100 text-slate-600';
            }
        }

        function getTypeTextDashboards(type) {
            switch(type) {
                case 'analytical': return '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞';
                case 'monitoring': return '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥';
                case 'operational': return '–û–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ';
                case 'reporting': return '–û—Ç—á–µ—Ç–Ω–æ—Å—Ç—å';
                case 'forecast': return '–ü—Ä–æ–≥–Ω–æ–∑';
                case 'audit': return '–î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ì–ë–£';
                default: return type;
            }
        }

        function getFrequencyTextDashboards(freq) {
            switch(freq) {
                case 'realtime': return '–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è';
                case 'daily': return '–ï–∂–µ–¥–Ω–µ–≤–Ω–æ';
                case 'weekly': return '–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ';
                case 'monthly': return '–ï–∂–µ–º–µ—Å—è—á–Ω–æ';
                case 'quarterly': return '–ö–≤–∞—Ä—Ç–∞–ª—å–Ω–æ';
                default: return freq;
            }
        }

        function toggleModalDashboards(show) {
            const modal = document.getElementById('modalDashboards');
            if (show) {
                modal.classList.remove('hidden');
                setTimeout(() => modal.classList.remove('opacity-0'), 10);
            } else {
                modal.classList.add('opacity-0');
                setTimeout(() => modal.classList.add('hidden'), 300);
            }
        }

        function closeModalDashboards() {
            toggleModalDashboards(false);
        }

        function toggleSelectionDashboards(id) {
            if (selectedIdsDashboards.has(id)) {
                selectedIdsDashboards.delete(id);
            } else {
                selectedIdsDashboards.add(id);
            }
            updateBulkToolbarDashboards();
            renderDashboardsGrid();
        }

        function toggleSelectAllDashboards() {
            const visibleCheckboxes = document.querySelectorAll('#cardsGridDashboards .custom-checkbox');
            const allSelected = Array.from(visibleCheckboxes).every(cb => cb.checked);
            
            visibleCheckboxes.forEach(cb => {
                const match = cb.getAttribute('onchange').match(/\d+/);
                if (match) {
                    const id = parseInt(match[0]);
                    if (allSelected) {
                        selectedIdsDashboards.delete(id);
                    } else {
                        selectedIdsDashboards.add(id);
                    }
                }
            });
            
            updateBulkToolbarDashboards();
            renderDashboardsGrid();
        }

        function clearSelectionDashboards() {
            selectedIdsDashboards.clear();
            updateBulkToolbarDashboards();
            renderDashboardsGrid();
        }

        function updateBulkToolbarDashboards() {
            const toolbar = document.getElementById('bulkToolbarDashboards');
            const countElement = document.getElementById('bulkCountDashboards');
            
            countElement.innerText = selectedIdsDashboards.size;
            
            if (selectedIdsDashboards.size > 0 && currentTab === 'dashboards') {
                toolbar.classList.remove('hidden');
            } else {
                toolbar.classList.add('hidden');
            }
        }

        function openBulkEditModalDashboards() {
            document.getElementById('bulkModalDashboards').classList.remove('hidden');
            setTimeout(() => document.getElementById('bulkModalDashboards').classList.remove('opacity-0'), 10);
        }

        function closeBulkModalDashboards() {
            document.getElementById('bulkModalDashboards').classList.add('opacity-0');
            setTimeout(() => document.getElementById('bulkModalDashboards').classList.add('hidden'), 300);
        }

        function applyBulkEditDashboards() {
            const status = document.getElementById('bulkStatusDashboards').value;
            const owner = document.getElementById('bulkOwnerDashboards').value.trim();
            const tags = document.getElementById('bulkTagsDashboards').value
                .split(',')
                .map(tag => tag.trim())
                .filter(tag => tag.length > 0);
            
            dashboardsData = dashboardsData.map(dashboard => {
                if (selectedIdsDashboards.has(dashboard.id)) {
                    const updated = { ...dashboard };
                    
                    if (status) updated.status = status;
                    if (owner) updated.owner = owner;
                    if (tags.length > 0) {
                        updated.tags = [...new Set([...(dashboard.tags || []), ...tags])];
                    }
                    
                    return updated;
                }
                return dashboard;
            });
            
            closeBulkModalDashboards();
            clearSelectionDashboards();
            saveDashboardsData();
        }

        function bulkDeleteDashboards() {
            if (selectedIdsDashboards.size === 0) return;
            
            if (confirm(`–£–¥–∞–ª–∏—Ç—å ${selectedIdsDashboards.size} –¥–∞—à–±–æ—Ä–¥(–æ–≤)?`)) {
                dashboardsData = dashboardsData.filter(d => !selectedIdsDashboards.has(d.id));
                clearSelectionDashboards();
                saveDashboardsData();
            }
        }

        function bulkOpenDashboards() {
            selectedIdsDashboards.forEach(id => {
                const dashboard = dashboardsData.find(d => d.id === id);
                if (dashboard && dashboard.url) {
                    window.open(dashboard.url, '_blank');
                }
            });
        }

        function deleteDashboard(id) {
            if (confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –¥–∞—à–±–æ—Ä–¥?")) {
                dashboardsData = dashboardsData.filter(d => d.id !== id);
                selectedIdsDashboards.delete(id);
                saveDashboardsData();
            }
        }

        function openDashboard(url) {
            window.open(url, '_blank');
        }

        function testUrlDashboards() {
            const url = document.getElementById('editUrlDashboards').value.trim();
            if (!url) {
                alert("–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏");
                return;
            }
            
            window.open(url, '_blank');
        }

      function exportToExcelDashboards() {
            const data = dashboardsData.map(d => ({
                '–ù–∞–∑–≤–∞–Ω–∏–µ': d.title,
                '–°—Å—ã–ª–∫–∞': d.url,
                '–û–ø–∏—Å–∞–Ω–∏–µ': d.description,
                '–¢–∏–ø –∞–Ω–∞–ª–∏–∑–∞': getTypeTextDashboards(d.analysisType),
                '–°—Ç–∞—Ç—É—Å': getStatusTextDashboards(d.status),
                '–í–ª–∞–¥–µ–ª–µ—Ü': d.owner,
                '–¢–µ–≥–∏': d.tags ? d.tags.join(', ') : '',
                '–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö': d.dataSource,
                '–ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è': getFrequencyTextDashboards(d.updateFrequency), // <-- –ò–∑–º–µ–Ω–µ–Ω–æ –Ω–∞–∑–≤–∞–Ω–∏–µ
                '–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è': d.createdDate ? new Date(d.createdDate).toLocaleDateString('ru-RU') : '',
                '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏': d.notes || ''
            }));
            
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "–î–∞—à–±–æ—Ä–¥—ã");
            
            const maxWidth = data.reduce((w, r) => Math.max(w, r['–ù–∞–∑–≤–∞–Ω–∏–µ']?.length || 0), 10);
            ws['!cols'] = [
                { wch: maxWidth },     // –ù–∞–∑–≤–∞–Ω–∏–µ
                { wch: 40 },           // –°—Å—ã–ª–∫–∞
                { wch: 50 },           // –û–ø–∏—Å–∞–Ω–∏–µ
                { wch: 15 },           // –¢–∏–ø –∞–Ω–∞–ª–∏–∑–∞
                { wch: 12 },           // –°—Ç–∞—Ç—É—Å
                { wch: 20 },           // –í–ª–∞–¥–µ–ª–µ—Ü
                { wch: 30 },           // –¢–µ–≥–∏
                { wch: 20 },           // –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö
                { wch: 20 },           // –ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è <-- –î–æ–±–∞–≤–ª–µ–Ω–∞ —à–∏—Ä–∏–Ω–∞
                { wch: 15 },           // –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
                { wch: 30 }            // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
            ];
            
            XLSX.writeFile(wb, `–î–∞—à–±–æ—Ä–¥—ã_GKO_${new Date().toISOString().split('T')[0]}.xlsx`);
        }
function parseExcelDate(value, rowIndex) {
    if (!value) return Date.now();
    
    // –ï—Å–ª–∏ —ç—Ç–æ —á–∏—Å–ª–æ (—Å–µ—Ä–∏–π–Ω–∞—è –¥–∞—Ç–∞ Excel)
    if (typeof value === 'number') {
        // Excel –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–µ—Ä–∏–π–Ω—ã–µ –¥–∞—Ç—ã, –≥–¥–µ 1 = 1 —è–Ω–≤–∞—Ä—è 1900
        // JavaScript –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã —Å 1 —è–Ω–≤–∞—Ä—è 1970
        const excelEpoch = new Date(1899, 11, 30); // 30 –¥–µ–∫–∞–±—Ä—è 1899
        const jsDate = new Date(excelEpoch.getTime() + value * 86400000);
        return jsDate.getTime();
    }
    
    // –ï—Å–ª–∏ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞
    if (typeof value === 'string') {
        // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –¥–∞—Ç
        const formats = [
            // DD.MM.YYYY
            /(\d{1,2})\.(\d{1,2})\.(\d{4})/,
            // YYYY-MM-DD
            /(\d{4})-(\d{1,2})-(\d{1,2})/,
            // MM/DD/YYYY
            /(\d{1,2})\/(\d{1,2})\/(\d{4})/
        ];
        
        for (const regex of formats) {
            const match = value.match(regex);
            if (match) {
                let day, month, year;
                
                if (regex.source.includes('YYYY-MM-DD')) {
                    // –§–æ—Ä–º–∞—Ç YYYY-MM-DD
                    year = parseInt(match[1], 10);
                    month = parseInt(match[2], 10) - 1;
                    day = parseInt(match[3], 10);
                } else if (regex.source.includes('MM/DD/YYYY')) {
                    // –§–æ—Ä–º–∞—Ç MM/DD/YYYY
                    month = parseInt(match[1], 10) - 1;
                    day = parseInt(match[2], 10);
                    year = parseInt(match[3], 10);
                } else {
                    // –§–æ—Ä–º–∞—Ç DD.MM.YYYY
                    day = parseInt(match[1], 10);
                    month = parseInt(match[2], 10) - 1;
                    year = parseInt(match[3], 10);
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –¥–∞—Ç—ã
                if (year >= 1900 && year <= 2100 && month >= 0 && month <= 11) {
                    const date = new Date(year, month, day);
                    if (!isNaN(date.getTime())) {
                        return date.getTime();
                    }
                }
            }
        }
        
        // –ü—Ä–æ–±—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥
        const parsed = new Date(value);
        if (!isNaN(parsed.getTime())) {
            return parsed.getTime();
        }
    }
    
    // –ï—Å–ª–∏ —ç—Ç–æ –æ–±—ä–µ–∫—Ç Date
    if (value instanceof Date) {
        return value.getTime();
    }
    
    console.warn(`–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –¥–∞—Ç—É –≤ —Å—Ç—Ä–æ–∫–µ ${rowIndex + 1}:`, value);
    return Date.now();
}
    function handleExcelImport(input) {
    const file = input.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { 
                type: 'array',
                cellDates: true, // –í–ê–ñ–ù–û: –ø–∞—Ä—Å–∏–º –¥–∞—Ç—ã –∫–∞–∫ –æ–±—ä–µ–∫—Ç—ã Date
                cellNF: false    // –û—Ç–∫–ª—é—á–∞–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–µ–ª –¥–ª—è —á–∏—Å—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            });
            
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º raw: false —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –¥–∞—Ç—ã –∫–∞–∫ –æ–±—ä–µ–∫—Ç—ã Date
            const json = XLSX.utils.sheet_to_json(sheet, { 
                defval: '',
                raw: false,      // –í–ê–ñ–ù–û: –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –¥–∞—Ç—ã –≤ —Å—Ç—Ä–æ–∫–∏
                dateNF: 'dd.mm.yyyy' // –§–æ—Ä–º–∞—Ç –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–∞—Ç
            });
            
            if (!json || json.length === 0) {
                alert("–§–∞–π–ª –ø—É—Å—Ç –∏–ª–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã—Ö");
                return;
            }
            
            const importedDashboards = [];
            let skippedRows = 0;
            
            json.forEach((row, index) => {
                if (!row['–ù–∞–∑–≤–∞–Ω–∏–µ'] || !row['–°—Å—ã–ª–∫–∞']) {
                    skippedRows++;
                    return;
                }
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                const statusText = row['–°—Ç–∞—Ç—É—Å']?.toString().toLowerCase() || '';
                let status = 'draft';
                if (statusText.includes('–∞–∫—Ç–∏–≤')) status = 'active';
                if (statusText.includes('–∞—Ä—Ö–∏–≤')) status = 'archived';
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∞–Ω–∞–ª–∏–∑–∞
                const typeText = row['–¢–∏–ø –∞–Ω–∞–ª–∏–∑–∞']?.toString().toLowerCase() || '';
                let analysisType = 'analytical';
                if (typeText.includes('–º–æ–Ω–∏—Ç–æ—Ä')) analysisType = 'monitoring';
                if (typeText.includes('–æ–ø–µ—Ä–∞—Ç–∏–≤')) analysisType = 'operational';
                if (typeText.includes('–æ—Ç—á–µ—Ç')) analysisType = 'reporting';
                if (typeText.includes('–ø—Ä–æ–≥–Ω–æ–∑')) analysisType = 'forecast';
                if (typeText.includes('–¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≥–±—É') || typeText.includes('–≥–±—É')) analysisType = 'audit';
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                const frequencyText = row['–ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è']?.toString().toLowerCase() || 
                                     row['–ß–∞—Å—Ç–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è']?.toString().toLowerCase() || 
                                     row['–ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å']?.toString().toLowerCase() || '';
                let updateFrequency = 'daily';
                if (frequencyText.includes('—Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è') || frequencyText.includes('—Ä–µ–∞–ª—Ç–∞–π–º')) updateFrequency = 'realtime';
                if (frequencyText.includes('–µ–∂–µ–¥–Ω–µ–≤–Ω–æ') || frequencyText.includes('daily')) updateFrequency = 'daily';
                if (frequencyText.includes('–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ') || frequencyText.includes('weekly')) updateFrequency = 'weekly';
                if (frequencyText.includes('–µ–∂–µ–º–µ—Å—è—á–Ω–æ') || frequencyText.includes('monthly')) updateFrequency = 'monthly';
                if (frequencyText.includes('–∫–≤–∞—Ä—Ç–∞–ª') || frequencyText.includes('quarterly')) updateFrequency = 'quarterly';
                
                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–µ–≥–∏
                const tags = row['–¢–µ–≥–∏'] ? 
                    row['–¢–µ–≥–∏'].toString().split(',').map(tag => tag.trim()).filter(tag => tag.length > 0) : 
                    [];
                
                // –ü–†–ê–í–ò–õ–¨–ù–û –û–ë–†–ê–ë–ê–¢–´–í–ê–ï–ú –î–ê–¢–£ –°–û–ó–î–ê–ù–ò–Ø
                let createdDate = Date.now();
                if (row['–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è']) {
                    try {
                        createdDate = parseExcelDate(row['–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è'], index);
                        
                        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
                        if (createdDate > Date.now() + 31536000000) { // –ë–æ–ª—å—à–µ –≥–æ–¥–∞ –≤ –±—É–¥—É—â–µ–º
                            console.warn(`–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≤ —Å—Ç—Ä–æ–∫–µ ${index + 1} –∫–∞–∂–µ—Ç—Å—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞`);
                            createdDate = Date.now();
                        }
                    } catch (e) {
                        console.error(`–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞—Ç—ã –≤ —Å—Ç—Ä–æ–∫–µ ${index + 1}:`, e);
                        createdDate = Date.now();
                    }
                }
                
                const newDashboard = {
                    id: Date.now() + index,
                    title: row['–ù–∞–∑–≤–∞–Ω–∏–µ'].toString().trim(),
                    url: row['–°—Å—ã–ª–∫–∞'].toString().trim().startsWith('http') ? 
                         row['–°—Å—ã–ª–∫–∞'].toString().trim() : 
                         `https://${row['–°—Å—ã–ª–∫–∞'].toString().trim()}`,
                    description: (row['–û–ø–∏—Å–∞–Ω–∏–µ'] || '').toString().trim(),
                    analysisType: analysisType,
                    status: status,
                    owner: (row['–í–ª–∞–¥–µ–ª–µ—Ü'] || '').toString().trim(),
                    tags: tags,
                    dataSource: (row['–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö'] || '').toString().trim(),
                    updateFrequency: updateFrequency,
                    notes: (row['–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏'] || '').toString().trim(),
                    createdDate: createdDate
                };
                
                importedDashboards.push(newDashboard);
            });
            
            if (importedDashboards.length === 0) {
                alert("–ù–µ –Ω–∞–π–¥–µ–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞");
                return;
            }
            
            const stats = `
–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –¥–∞—à–±–æ—Ä–¥–æ–≤: ${importedDashboards.length}
–ü—Ä–æ–ø—É—â–µ–Ω–æ —Å—Ç—Ä–æ–∫: ${skippedRows}

–ü—Ä–∏–º–µ—Ä—ã –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞—Ç:
${importedDashboards.slice(0, 3).map(d => 
    `‚Ä¢ "${d.title}": ${new Date(d.createdDate).toLocaleDateString('ru-RU')}`
).join('\n')}

–î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥—ã –≤ –Ω–∞—á–∞–ª–æ —Å–ø–∏—Å–∫–∞?
            `.trim();
            
            if (confirm(stats)) {
                dashboardsData = [...importedDashboards, ...dashboardsData];
                saveDashboardsData();
                alert("–î–∞—à–±–æ—Ä–¥—ã —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!");
            }
            
        } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞:", error);
            alert(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–∞–π–ª–∞: ${error.message}`);
        }
    };
    
    reader.onerror = function() {
        alert("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞");
    };
    
    reader.readAsArrayBuffer(file);
    input.value = '';
}

        function hardResetDashboards() {
            if (confirm("–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥–æ–≤? –í—Å–µ —Ç–µ–∫—É—â–∏–µ –¥–∞—à–±–æ—Ä–¥—ã –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.")) {
                localStorage.removeItem(STORAGE_KEY_DASHBOARDS);
                loadDashboardsData();
            }
        }
        // ============== –û–ë–©–ò–ï –§–£–ù–ö–¶–ò–ò –ò–ú–ü–û–†–¢–ê ==============
function handleExcelImport(input) {
    const file = input.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { 
                type: 'array',
                cellDates: true, // –í–ê–ñ–ù–û: –ø–∞—Ä—Å–∏–º –¥–∞—Ç—ã –∫–∞–∫ –æ–±—ä–µ–∫—Ç—ã Date
                cellNF: false    // –û—Ç–∫–ª—é—á–∞–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–µ–ª –¥–ª—è —á–∏—Å—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            });
            
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º raw: false —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –¥–∞—Ç—ã –∫–∞–∫ –æ–±—ä–µ–∫—Ç—ã Date
            const json = XLSX.utils.sheet_to_json(sheet, { 
                defval: '',
                raw: false,      // –í–ê–ñ–ù–û: –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –¥–∞—Ç—ã –≤ —Å—Ç—Ä–æ–∫–∏
                dateNF: 'dd.mm.yyyy' // –§–æ—Ä–º–∞—Ç –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–∞—Ç
            });
            
            if (!json || json.length === 0) {
                alert("–§–∞–π–ª –ø—É—Å—Ç –∏–ª–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã—Ö");
                return;
            }
            
            const importedDashboards = [];
            let skippedRows = 0;
            
            json.forEach((row, index) => {
                if (!row['–ù–∞–∑–≤–∞–Ω–∏–µ'] || !row['–°—Å—ã–ª–∫–∞']) {
                    skippedRows++;
                    return;
                }
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                const statusText = row['–°—Ç–∞—Ç—É—Å']?.toString().toLowerCase() || '';
                let status = 'draft';
                if (statusText.includes('–∞–∫—Ç–∏–≤')) status = 'active';
                if (statusText.includes('–∞—Ä—Ö–∏–≤')) status = 'archived';
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∞–Ω–∞–ª–∏–∑–∞
                const typeText = row['–¢–∏–ø –∞–Ω–∞–ª–∏–∑–∞']?.toString().toLowerCase() || '';
                let analysisType = 'analytical';
                if (typeText.includes('–º–æ–Ω–∏—Ç–æ—Ä')) analysisType = 'monitoring';
                if (typeText.includes('–æ–ø–µ—Ä–∞—Ç–∏–≤')) analysisType = 'operational';
                if (typeText.includes('–æ—Ç—á–µ—Ç')) analysisType = 'reporting';
                if (typeText.includes('–ø—Ä–æ–≥–Ω–æ–∑')) analysisType = 'forecast';
                if (typeText.includes('–¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≥–±—É') || typeText.includes('–≥–±—É')) analysisType = 'audit';
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                const frequencyText = row['–ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è']?.toString().toLowerCase() || 
                                     row['–ß–∞—Å—Ç–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è']?.toString().toLowerCase() || 
                                     row['–ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å']?.toString().toLowerCase() || '';
                let updateFrequency = 'daily';
                if (frequencyText.includes('—Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è') || frequencyText.includes('—Ä–µ–∞–ª—Ç–∞–π–º')) updateFrequency = 'realtime';
                if (frequencyText.includes('–µ–∂–µ–¥–Ω–µ–≤–Ω–æ') || frequencyText.includes('daily')) updateFrequency = 'daily';
                if (frequencyText.includes('–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ') || frequencyText.includes('weekly')) updateFrequency = 'weekly';
                if (frequencyText.includes('–µ–∂–µ–º–µ—Å—è—á–Ω–æ') || frequencyText.includes('monthly')) updateFrequency = 'monthly';
                if (frequencyText.includes('–∫–≤–∞—Ä—Ç–∞–ª') || frequencyText.includes('quarterly')) updateFrequency = 'quarterly';
                
                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–µ–≥–∏
                const tags = row['–¢–µ–≥–∏'] ? 
                    row['–¢–µ–≥–∏'].toString().split(',').map(tag => tag.trim()).filter(tag => tag.length > 0) : 
                    [];
                
                // –ü–†–ê–í–ò–õ–¨–ù–û –û–ë–†–ê–ë–ê–¢–´–í–ê–ï–ú –î–ê–¢–£ –°–û–ó–î–ê–ù–ò–Ø
                let createdDate = Date.now();
                if (row['–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è']) {
                    try {
                        createdDate = parseExcelDate(row['–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è'], index);
                        
                        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
                        if (createdDate > Date.now() + 31536000000) { // –ë–æ–ª—å—à–µ –≥–æ–¥–∞ –≤ –±—É–¥—É—â–µ–º
                            console.warn(`–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≤ —Å—Ç—Ä–æ–∫–µ ${index + 1} –∫–∞–∂–µ—Ç—Å—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞`);
                            createdDate = Date.now();
                        }
                    } catch (e) {
                        console.error(`–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞—Ç—ã –≤ —Å—Ç—Ä–æ–∫–µ ${index + 1}:`, e);
                        createdDate = Date.now();
                    }
                }
                
                const newDashboard = {
                    id: Date.now() + index,
                    title: row['–ù–∞–∑–≤–∞–Ω–∏–µ'].toString().trim(),
                    url: row['–°—Å—ã–ª–∫–∞'].toString().trim().startsWith('http') ? 
                         row['–°—Å—ã–ª–∫–∞'].toString().trim() : 
                         `https://${row['–°—Å—ã–ª–∫–∞'].toString().trim()}`,
                    description: (row['–û–ø–∏—Å–∞–Ω–∏–µ'] || '').toString().trim(),
                    analysisType: analysisType,
                    status: status,
                    owner: (row['–í–ª–∞–¥–µ–ª–µ—Ü'] || '').toString().trim(),
                    tags: tags,
                    dataSource: (row['–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö'] || '').toString().trim(),
                    updateFrequency: updateFrequency,
                    notes: (row['–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏'] || '').toString().trim(),
                    createdDate: createdDate
                };
                
                importedDashboards.push(newDashboard);
            });
            
            if (importedDashboards.length === 0) {
                alert("–ù–µ –Ω–∞–π–¥–µ–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞");
                return;
            }
            
            const stats = `
–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –¥–∞—à–±–æ—Ä–¥–æ–≤: ${importedDashboards.length}
–ü—Ä–æ–ø—É—â–µ–Ω–æ —Å—Ç—Ä–æ–∫: ${skippedRows}

–ü—Ä–∏–º–µ—Ä—ã –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞—Ç:
${importedDashboards.slice(0, 3).map(d => 
    `‚Ä¢ "${d.title}": ${new Date(d.createdDate).toLocaleDateString('ru-RU')}`
).join('\n')}

–î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥—ã –≤ –Ω–∞—á–∞–ª–æ —Å–ø–∏—Å–∫–∞?
            `.trim();
            
            if (confirm(stats)) {
                dashboardsData = [...importedDashboards, ...dashboardsData];
                saveDashboardsData();
                alert("–î–∞—à–±–æ—Ä–¥—ã —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!");
            }
            
        } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞:", error);
            alert(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–∞–π–ª–∞: ${error.message}`);
        }
    };
    
    reader.onerror = function() {
        alert("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞");
    };
    
    reader.readAsArrayBuffer(file);
    input.value = '';
}

        // ============== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==============
        window.addEventListener('DOMContentLoaded', function() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–µ–∏—Ö –≤–∫–ª–∞–¥–æ–∫
            loadData();
            loadDashboardsData(); // –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–∞—à–±–æ—Ä–¥–æ–≤
            
            // –ó–∞—Ç–µ–º –ø—ã—Ç–∞–µ–º—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å GitHub
            loadFromGitHub().then(() => {
                console.log('‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
            }).catch((error) => {
                console.log('‚ö†Ô∏è GitHub –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:', error.message);
            });
        });
    </script>
</body>
</html>
